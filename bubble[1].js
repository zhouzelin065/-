(function(){var e;e=new RegExp("development").test(sdk.env),window.config={enable:!0,intervalBetweenTwoBubbles:e?18e5:36e5,configListLoadInterval:36e5,pluginReloadMaxNum:1,bubble_popup_info_probability:.01,page_reload_time_interval:36e5,service_reload_time_interval:36e5,process_exit_timeout:18e5,view_exit_timeout:3e4,update_history_interval:216e6,bubble_is_hidden_timeout:1e4,maxReloadNumADay:3}}).call(this),function(){window.constant={BUBBLE_LAST_LOAD_TIME:"time_last_load",STORAGE_KEY_BUBBLE_DATE_POPUP:"time_popup",STORAGE_KEY_BUBBLE_DATE_CLICK:"time_click",STORAGE_KEY_BUBBLE_DATE_CLOSE:"time_close",STORAGE_KEY_BUBBLE_DATE_MISTAKE_CLICK:"time_mistake_click",STORAGE_KEY_BUBBLE_CLOSE_TYPE:"close_type",INI_PRE_KEY_BUBBLE_FAIL_LAST_SENT_TIME:"time_bubble_file_info_last_sent",FEATURE_WINDOW_PREFIX:"DD6CB1B6-9571-4450-8206-E9BA4A574C3E",AD_WINDOW_TITLE:"广告",TYPE_CLOSE_BY_CLOSE_BTN:1,TYPE_CLOSE_BY_NORMAL_CLICK_EVENT:2,TYPE_CLOSE_BY_TIMEOUT:3,TYPE_CLOSE_BY_FORCE:4,TYPE_CLOSE_BY_NOT_INTERESTED:5,TYPE_CLOSE_BY_RETRY:6,TYPE_CLOSE_BY_TRY_CLICK_HAT:7,TYPE_CLOSE_BY_AS_HIDDEN:8,TYPE_CLOSE_BY_WEBVIEW_STOP:9,TYPE_CLOSE_BY_CMD:10,TYPE_CLOSE_BY_VIP_GUIDE:11,TYPE_CLOSE_BY_RELOAD:12,TYPE_CLOSE_BY_NON_HEARTBEAT:13,TYPE_CLOSE_BY_OVERLAY_GROUP:14,TYPE_CLOSE_BY_MIDNIGHT_RELOAD:15,TYPE_CLOSE_BY_HIDDEN:16,TYPE_CLOSE_BY_MENU_QUIT:17,TYPE_CLOSE_BY_MENU_SILENCE:18,TYPE_CLOSE_BY_OUTER_MSG:19,CODE_REASON_LAST_EXIT_ABNORMAL:"0",CODE_REASON_LAST_EXIT_SHUTDOWN:"1",CONE_REASON_LAST_EXIT_NORMAL:"5",HIDDEN_CODE:{QT:1,WINDOWS:2,LOCATION:3,SIZE:4,TASKLIST:5},DOUBTFUL_PROCESS:{"zhudongfangyu.exe":1,"360tray.exe":2,"sogoucloud.exe":3,"sgtool.exe":4,"360bdoctor.exe":5,"wdswfsafe.exe":6,"360se.exe":7,"360sd.exe":8,"qqpcrtp.exe":9,"securityhealthservice.exe":10,"softupnotify.exe":11,"sohunews.exe":12,"navplugin.exe":13,"qykernel.exe":14,"computerzservice.exe":15,"kxescore.exe":16,"kxetray.exe":17,"popwndlog.exe":18,"360leakfixer.exe":19,"360desktoplite64.exe":20,"2345pinyincloud.exe":21,"protect_2345explorer.exe":22,"pinyin_2345svc.exe":23,"haozipsvc.exe":24,"qqpctray.exe":25},PLUGIN_EXIT_CODE:{START:0,STOP:1,RESTART:2,NO_EXECUTABLE_BUBBLE:3,CHANNEL_SCREENED:4,INVALID_ENV:5,ANOTHER_DAY:6,RUN_WITH_OTHER_EXE:7,RUN_WITH_KBUBBLE2:8,RESTART_FAILED:9,CONFIG_UPDATE_INTERVAL:10,SHOPPING_RESTART:11},PROCESS_EFFECT:{"wps.exe":1,"360tray.exe":2,"sogoucloud.exe":3,"wechat.exe":4,"igfxem.exe":5,"qq.exe":6,"360se.exe":7,"360speedld.exe":8,"nvdisplay.container.exe":9,"qqpcrtp.exe":10,"alibabaprotect.exe":11,"360sd.exe":12,"qqbrowser.exe":13,"applemobiledevicehelper.exe":14,"qqlive.exe":15,"calendaractive.exe":16,"qykernel.exe":17,"chrome.exe":18,"tencentdl.exe":19,"dingtalk.exe":20,"kxetray.exe":21,"popwndlog.exe":22,"dgservice.exe":23,"pic_2345svc.exe":24,"pdfspeedup.exe":25,"haozip.exe":26,"baidunetdisk.exe":27,"pinyin_2345svc.exe":28,"qmbsrv.exe":29,"2345safecentersvc.exe":30,"kugou.exe":31,"sogouexplorer.exe":32,"360chrome.exe":33,"lenovo.modern.imcontroller.exe":34,"ldslite.exe":35,"qqmusic.exe":36,"tcls_core.exe":37,"ptxbootsvc.exe":38,"photolaunch.exe":39,"cloudmusic.exe":40,"qqpyusercenter.exe":41,"sangforpromoteservice.exe":42,"ibmpmsvc.exe":43,"wegame.exe":44,"teamviewer_service.exe":45,"hplaserjetservice.exe":46,"thunder.exe":47,"nethelper360.exe":48,"tbsecsvc.exe":49,"leagueclient.exe":50,"usbkeytools.exe":51,"qtalk.exe":52,"kwservice.exe":53,"atkexcomsvc.exe":54,"2345explorer.exe":86,"coupontray.exe":56,"2345softmgr.exe":57,"league of legends.exe":58,"upservice.exe":59,"photoshop.exe":60,"coreldrw.exe":61,"gamebar.exe":62,"cajshost.exe":63,"steam.exe":64,"xshell.exe":65,"foxmail.exe":66,"idea64.exe":67,"java.exe":68,"notepad++.exe":69,"tim.exe":70,"wpp.exe":71,"et.exe":72,"powerword.exe":73,"aliim.exe":74,"acrord32.exe":75,"excel.exe":76,"evernote.exe":77,"onenoteim.exe":78,"pycharm64.exe":79,"onenote.exe":80,"virtualbox.exe":81,"powerpnt.exe":82,"code.exe":83,"winword.exe":84,"360safe.exe":85,"acad.exe":87,"wxwork.exe":88,"youkudesktop.exe":89,"mysqld.exe":90,"wnziptool.exe":91,"huyaservice.exe":92,"thunderplatform.exe":93,"fastinvoiceassist.exe":94,"ccbcertificate.exe":95,"d4ser_icbc.exe":96,"abcebservice.exe":97,"bocbanktray.exe":98,"qtwebengineprocess.exe":99,"yy.exe":100,"youdaodict.exe":101,"foxitprotect.exe":102,"chinatax.exe":103,"qqgame.exe":104,"huyaclient.exe":105,"yybrowser.exe":106,"cadreader.exe":107,"mailmaster.exe":108,"cclibrary.exe":109,"tsvncache.exe":110,"matebookservice.exe":111,"androidservice.exe":112,"360mobilemgr.exe":113,"adb.exe":114,"vmware-tray.exe":115,"aisino.framework.startup.exe":116,"xwsvchosts.exe":117,"xmp.exe":118,"qqpycloud.exe":119,"cnab4rpk.exe":120,"eebsvc.exe":121,"qqgame.exe":122,"芒果tv极速版.exe":123,"haozip.exe":124,"kisapjob.exe":125,"gws.exe":126,"hpstatusalerts.exe":127,"asldrsrv.exe":128,"adaptivesleepservice.exe":129,"huaweihisuiteservice.exe":130,"baofengplatform.exe":131,"uu.exe":132,"wowclassic.exe":133,"tslgame.exe":134,"douyulive.exe":135,"hexin.exe":136,"xiadan.exe":137,"iflyplatform.exe":138,"dnf.exe":139,"youdaonote.exe":140,"eclipse.exe":141,"liebao.exe":142,"stockway.exe":143,"dzh2.exe":144,"ppap.exe":145,"firefox.exe":146,"crossfire.exe":147,"jupyter-notebook.exe":148,"python.exe":149,"dellsupportassistremedationservice.exe":150}}}.call(this),function(){var e;e=function(){function e(e){var t,o,i,s,n,r,a,u,c,l,d;for(this.config=e,this.observer=new sdk["class"].Observer,this._id=this.config._id,this.is_ad="1"===this.config.is_ad||"2"===this.config.is_ad||"3"===this.config.is_ad,this.storageKeyGroup="bubble_"+this._id,this.storageKeyExecNum="exec_num_all",this.storageKeyLastExecTime="last_exec_time",this.storageKeyContinueCloseNum="continue_close_num",this.storageKeyExecNumTodayPrefix="exec_num",this.storageKeyLastFailInfoSetTime="last_fail_info_sent_time",this.storageKeyLastFailInfoCode="last_fail_info_code",this.taskbarLinks=(this.config._taskbar_links||"").toLowerCase(),this.desktopLinks=(this.config._desktop_links||"").toLowerCase(),this.softList=this.config._soft_list||"",this.processList=(this.config._process_list||"").toLowerCase(),this.regList=this.config._reg_list||"",this.condFunc=this.config._cond_func||"function(){return true}",this.exceptPaidUser="1"===(this.config._expect_paid_user||"1"),this.exceptSeriousScene="0;"+(this.config._expect_serious_scene||""),this.shieldInterceptor="1"===(this.config._shield_interceptor||"1"),this.timeEffect=this.config._time_effect,this.timeSlot=this.config._time_slot||"00:00-24:00",this.effectTimeInterval=6e4*(this.config._time_interval-0)||3e5,this.globalTimeInterval=6e4*(this.config._adSpecial_time_interval-0)||config.intervalBetweenTwoBubbles,this.globalTimeInterval=Math.max(this.globalTimeInterval,15e3),this.globalClickTimeInterval=this.config._global_click_time_interval?6e4*(this.config._global_click_time_interval-0):0,this.maxNumaDay=this.config._number_everyday||1,this.maxNum=this.config._number_total||5,this.autoCloseTimeout=6e4*(this.config.time_auto_close-0||360),this.notifyGroup=[],l=(this.config._group_name||"").split(";"),s=0,a=l.length;s<a;s++)c=l[s],c&&this.notifyGroup.push(c);if(this.overlayGroup=this.config.overlay_group||"",this.hasHighValue="true"===this.config.has_high_value||!1,this.timeExecDelay=6e4*this.config._time_delay||0,this.disabledPageReload=!!-this.config._disabled_page_reload,this.config.continue_close_set)try{for(t=this.config.continue_close_set.split(","),n=r=0,u=t.length;r<u;n=++r)d=t[n],t[n]=d.split("=");this.continueCloseShield=t}catch(i){o=i}this.info={}}return e.prototype._backupGlobalLastExecDate=function(){return this.globalLastExecTime=sdk.bubble.getGlobalLastExecDate()-0},e.prototype._rollbackGlobalLastExecDate=function(){return sdk.bubble.setGlobalLastExecDate(this.globalLastExecTime||"")},e.prototype._setLastExecDate=function(){var e;return e=sdk.util.getNow(),sdk.tools.storage.set(this.storageKeyLastExecTime,e-0,this.storageKeyGroup)},e.prototype._getLastExecDate=function(){var e;return e=sdk.tools.storage.get(this.storageKeyLastExecTime,this.storageKeyGroup),e?new Date(e-0):null},e.prototype._addExecNumToday=function(){var e,t,o;return t=this._getExecNumToday()+1,e=sdk.util.getNow(),o=sdk.util.formatDate(e,"yyyy_MM_dd"),sdk.tools.storage.set(this.storageKeyExecNumTodayPrefix+"_"+o,t,this.storageKeyGroup)},e.prototype._getExecNumToday=function(){var e,t;return e=sdk.util.getNow(),t=sdk.util.formatDate(e,"yyyy_MM_dd"),sdk.tools.storage.get(this.storageKeyExecNumTodayPrefix+"_"+t,this.storageKeyGroup)-0||0},e.prototype._addExecNumTotal=function(){var e;return e=this._getExecNumTotal()+1,sdk.tools.storage.set(this.storageKeyExecNum,e,this.storageKeyGroup)},e.prototype._getExecNumTotal=function(){return sdk.tools.storage.get(this.storageKeyExecNum,this.storageKeyGroup)-0||0},e.prototype._addContinueCloseNum=function(){var e,t;if(t=this._getContinueCloseNum()+1,sdk.noop(),sdk.tools.storage.set(this.storageKeyContinueCloseNum,t,this.storageKeyGroup),"normal_ex_bubble"!==this.config._template_type)return e=sdk.tools.storage.get(this.storageKeyContinueCloseNum)-0||0,e++,e>=2&&(sdk.tools.storage.set("last_continue_close",sdk.util.getNow()-0),e=0),sdk.tools.storage.set(this.storageKeyContinueCloseNum,e)},e.prototype._resetContinueCloseNum=function(){if(sdk.tools.storage.set(this.storageKeyContinueCloseNum,0,this.storageKeyGroup),"normal_ex_bubble"!==this.config._template_type)return sdk.tools.storage.set(this.storageKeyContinueCloseNum,0)},e.prototype._getContinueCloseNum=function(){return sdk.noop(),sdk.tools.storage.get(this.storageKeyContinueCloseNum,this.storageKeyGroup)-0||0},e.prototype._getBubbleLastPopupFailInfoSentTime=function(){return sdk.tools.storage.get(this.storageKeyLastFailInfoSetTime,this.storageKeyGroup)-0||0},e.prototype._setBubbleLastPopupFailInfoSentTime=function(){return sdk.tools.storage.set(this.storageKeyLastFailInfoSetTime,sdk.util.getNow()-0,this.storageKeyGroup)},e.prototype._getBubbleLastPopupFailInfoCode=function(){return sdk.noop(),sdk.tools.storage.get(this.storageKeyLastFailInfoCode,this.storageKeyGroup)-0||0},e.prototype._setBubbleLastPopupFailInfoCode=function(e){return sdk.noop(),sdk.tools.storage.set(this.storageKeyLastFailInfoCode,e,this.storageKeyGroup)},e.prototype._sendPopupFailInfo=function(e){var t,o;if(0!==e&&1e3!==e&&8e3!==e&&e<9e3&&sdk.noop(),"1"!==this.config._disabled_popup_fail_info)return o=sdk.util.formatDate(new Date,"yyyy-MM-dd"),t=sdk.util.formatDate(this._getBubbleLastPopupFailInfoSentTime(),"yyyy-MM-dd"),t!==o||e>this._getBubbleLastPopupFailInfoCode()?(sdk.noop(),sdk.service.info.bubblePopupFail(this._id,this.config._name,e),this._setBubbleLastPopupFailInfoSentTime(),this._setBubbleLastPopupFailInfoCode(e)):void 0},e.prototype.setMsgGroupInfo=function(e){return this.MsgGroupInfo=e},e.prototype.getMsgGroupInfo=function(){return this.MsgGroupInfo},e.prototype.setBubbleInfo=function(e){var t,o,i;o=[];for(t in e)i=e[t],sdk.util.iniCache.set(this._id+"_"+t,i),o.push(this.info[t]=i);return o},e.prototype.getBubbleInfo=function(e){return this.info[e]||sdk.util.iniCache.get(this._id+"_"+e)||""},e.prototype.putInBubbleInfo=function(){return sdk.util.regCache.set(this._id,this.info)},e.prototype.takeOutBubbleInfo=function(){var e;return e=sdk.util.regCache.take(this._id),this.setBubbleInfo(e)},e.prototype.getAdType=function(){return"1"===this.config.is_ad||"2"===this.config.is_ad||"3"===this.config.is_ad?"ad_normal":"0"!==this.config.is_ad||"commercial"!==this.config.purpose&&"own_product"!==this.config.purpose?"feature":"ad_special"},e.prototype.exec=function(){return this.executing=!0,sdk.noop(),sdk.client.plugin.stopExit(),this.alive=!0,this.setBubbleInfo({adType:this.getAdType()}),this.executing=!1},e.prototype.isAlive=function(){return this.alive},e.prototype.recordPopup=function(){return this._setLastExecDate(),this._addExecNumToday(),this._addExecNumTotal()},e.prototype.destroy=function(){return this.alive=!1,this.observer.fire("destroy",this._id)},e}(),window.BubbleBase=e}.call(this),function(){var BubbleCheck,extend=function(e,t){function o(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;BubbleCheck=function(superClass){function BubbleCheck(e){this.config=e,BubbleCheck.__super__.constructor.call(this,this.config),this.scene_shield_ratio=this.config.scene_screen_rate-0,this.scene_shield_ratio=this.scene_shield_ratio>=10?this.scene_shield_ratio/100:0,this.initReport()}return extend(BubbleCheck,superClass),BubbleCheck.prototype.canPopup=function(e,t,o){return null==o&&(o=sdk.noop),this.isAlive()||this.executing?(sdk.noop(),this._sendPopupFailInfo(10),o(!1)):this.isValid(e,t)?this.isValidAsyn(e,t,function(i){return function(s){return sdk.noop(),s?i.isAlive()||i.executing||!i.isValid(e,t)?(i._sendPopupFailInfo(9e3),o(!1)):o(!0):(i._sendPopupFailInfo(8e3),o(!1))}}(this)):(this._sendPopupFailInfo(1e3),o(!1))},BubbleCheck.prototype._feedbackExec=function(e,t){if(1===Math.ceil(Math.random()/t))return sdk.util.justSend("http://pcfg.wps.cn:9002/config/info/popupTry/"+e+"/"+t+"/0")},BubbleCheck.prototype.matchNotify=function(msg,info,callback){var browserName,cb,hours,keyword,pid;if("browsetheweb"===msg&&info)try{info=eval("("+info+")"),pid=info.pid,browserName=info["browserName".toLowerCase()],info=sdk.bubble.rmBrowserName(info.title)}catch(undefined){}if(/^browsetheweb_common/.test(msg))try{info=eval("("+info+")"),pid=info.pid,browserName=info.name,info=info.text}catch(undefined){}return sdk.noop(),cb=function(e){return function(t){return t&&e.recordNotify(msg,info,t,pid,browserName),callback&&callback(t),t}}(this),msg?0===this.notifyGroup.length&&"kscreensaver_comeback"!==msg?cb(!0):sdk.util.indexOf(msg,this.notifyGroup)>-1?this.config._group_info?(hours=this.config._include_history_hours-0,hours&&"ruby"===sdk.platform?(keyword=sdk.bubble.ifMatchTags(info,this.config._group_info))?cb(keyword):sdk.system.getRecentBrowserHistoryTitle(hours,function(e){return function(t){var o,i,s;for(o=0,i=t.length;o<i;o++)if(s=t[o],keyword=sdk.bubble.ifMatchTags(s,e.config._group_info))return info=s,cb(keyword);return cb(!1)}}(this)):cb(info?sdk.bubble.ifMatchTags(info,this.config._group_info):!1)):cb("null"):cb(!1):cb(0===this.notifyGroup.length)},BubbleCheck.prototype.recordNotify=function(e,t,o,i,s){var n;return t&&this.setMsgGroupInfo(t),n={},e&&(n.msg=e),t&&(n.msgInfo=t),o&&(n.keyword=o),i&&(n.msgPid=i),s&&(n.msgBrowser=s),this.setBubbleInfo(n)},BubbleCheck.prototype.isLastDoubleCheckReqValid=function(){var e,t,o,i;return o=sdk.client.user.getLastDoubleCheckTime(),e=864e5,!!o&&(sdk.noop(),!(o&&o-0+7*e<sdk.util.getNow().getTime())&&(!!(t=sdk.client.user.getLastLoginUserData())&&(i=sdk.client.user.getLastLoginUserId(),t=t.split("_"),3===t.length&&t[0]===i)))},BubbleCheck.prototype.doubleCheck=function(e){var t,o;return t=this,o=sdk.client.user.getLastLoginUserId(),sdk.util.justSend("http://pcfg.wps.cn:9002/config/info/double_check/1/0"),sdk.client.user.requestInfoByUserId(o,function(o){return e(o?!0:!t.isNonAdMember())})},BubbleCheck.prototype.isNonAdMember=function(){return sdk.noop(),sdk.client.user.isNonAdMemberByReg()},BubbleCheck.prototype.popupIntervalCheck=function(){var e;return e=sdk.util.getNow(),this instanceof CustomBubble||!(e-sdk.bubble.getGlobalLastExecDate()<this.globalTimeInterval)||(this.failedReason=4,sdk.noop(),!1)},BubbleCheck.prototype.clickIntervalCheck=function(){var e;return e=sdk.util.getNow(),!this.globalClickTimeInterval||(this instanceof CustomBubble||!(e-sdk.bubble.getGlobalLastClickTime()<this.globalClickTimeInterval)||(this.failedReason=4,sdk.noop(),!1))},BubbleCheck.prototype.isValid=function(msg,info){var condRet,err,error,error1,func,funcStr,i,len,now,ref,ref1,shield;if(now=sdk.util.getNow(),this.alive)return sdk.noop(),!1;if(this.is_ad&&sdk.client.info.getAdType()!==this.config.is_ad)return sdk.noop(),!1;if(!this.popupIntervalCheck())return this._sendPopupFailInfo(2010),!1;if(!this.clickIntervalCheck())return this._sendPopupFailInfo(2050),!1;if(this.exceptPaidUser&&sdk.client.user.isPaidUser())return this._sendPopupFailInfo(3010),!1;if(""===sdk.client.user.getUserType()&&sdk.client.user.getLastLoginUserId()&&this.exceptPaidUser&&this.isLastDoubleCheckReqValid()&&this.isNonAdMember())return this._sendPopupFailInfo(3020),!1;if(this.exceptPaidUser&&"1"!==(ref=this.config.have_priority)&&"2"!==ref&&sdk.client.info.isEduVersion())return this._sendPopupFailInfo(3030),!1;if(this.exceptPaidUser&&sdk.client.user.isComplainedUser())return this._sendPopupFailInfo(3050),!1;if(this.shieldInterceptor&&sdk.util.indexOf("qg",sdk.as.getAsProcess("name"))>-1&&sdk.as.existInterceptionRule("qg"))return this._sendPopupFailInfo(3070),!1;if(this.is_ad){if(sdk.client.info.isInstallNewUser())return this._sendPopupFailInfo(4010),!1;if("windows xp"===sdk.system.getOsName()&&sdk.util.indexOf("kscreensaverapp.exe",sdk.system.listProcesses())>=0)return this._sendPopupFailInfo(4015),!1;if(sdk.client.info.hasInstallWps()||"qing"===sdk.client.info.getAppName()){if("1"===this.config.is_ad)return!1;if("2"===this.config.is_ad){if(sdk.bubble.getGlobalLastWeekPopupNum()>=8)return this._sendPopupFailInfo(4030),!1;if(sdk.bubble.getGlobalTodayPopupNum()>=3)return this._sendPopupFailInfo(4035),!1;if(sdk.bubble.getMiniRegLastMonthAdNum()>=8)return sdk.noop(),this._sendPopupFailInfo(4050),!1;if("2"===this.config.have_priority){if(sdk.bubble.getMiniRegTodayNum()>=3)return this._sendPopupFailInfo(4075),!1}else if("1"===this.config.have_priority){if(sdk.bubble.getMiniRegTodayNum()>=2)return this._sendPopupFailInfo(4085),!1}else{if(sdk.bubble.getMiniRegLastMonthAdNum()>=4)return this._sendPopupFailInfo(4092),!1;if(sdk.bubble.getMiniRegLastWeekNum()>=1)return this._sendPopupFailInfo(4095),!1}}if("3"===this.config.is_ad)return!1}}if(this.config._substance_group&&this.config._substance_interval&&(this.substanceMutex=!0,!sdk.bubble.checkSubstanceMutex(this.config._substance_group,this.config._substance_interval)))return this._sendPopupFailInfo(5050),!1;if(now-this._getLastExecDate()<this.effectTimeInterval)return sdk.noop(),this._sendPopupFailInfo(6010),!1;if(this._getExecNumToday()>=this.maxNumaDay)return this._sendPopupFailInfo(6030),!1;if(this._getExecNumTotal()>=this.maxNum)return this._sendPopupFailInfo(6050),!1;if(this.continueCloseShield&&this.continueCloseShield.length>0)for(ref1=this.continueCloseShield,i=0,len=ref1.length;i<len;i++){shield=ref1[i];try{if(shield[0]-0===this._getContinueCloseNum()&&now-this._getLastExecDate()<1440*shield[1]*6e4)return this._sendPopupFailInfo(6070),!1}catch(error){err=error,sdk.noop()}}if(!sdk.bubble.isTimeEffect(this.timeEffect))return this._sendPopupFailInfo(7010),!1;if(!this._inTimeSlot())return this._sendPopupFailInfo(7015),!1;if(this.softList&&!this._ifInInOutObj(this.softList,sdk.system.listSoftWare()))return this._sendPopupFailInfo(7020),!1;if(!this._ifInInOutObj(this.processList,sdk.system.listProcesses()))return this._sendPopupFailInfo(7030),!1;if(!this._ifInInOutObj(this.desktopLinks,sdk.system.listDesktopLinks()))return this._sendPopupFailInfo(7040),!1;if(!this._ifInInOutObj(this.taskbarLinks,sdk.system.listTaskbarLinks()))return this._sendPopupFailInfo(7050),!1;if(!this._ifValidReg(this.regList))return this._sendPopupFailInfo(7060),!1;try{funcStr="false||("+this.condFunc+")",func=eval(funcStr),condRet=func(this.config._id,this.config._name,msg,info)}catch(error1){err=error1,sdk.noop(),condRet=!1}finally{if(!condRet)return this._sendPopupFailInfo(7080),!1}return!0},BubbleCheck.prototype.isValidAsyn=function(msg,info,cb){var callback,funcIndex,funcQueue;return funcQueue=[],funcQueue.push(function(e){return function(){return e.matchNotify(msg,info,function(t){return t||e._sendPopupFailInfo(8010),callback(t)})}}(this)),funcQueue.push(function(e){return function(){return"1"===e.config._check_realtime_valid?e._ifConfigValid(function(t){return t||e._sendPopupFailInfo(8030),callback(t)}):callback(!0)}}(this)),funcQueue.push(function(e){return function(){var t;return e.exceptPaidUser?(t=e.config._name,""===sdk.client.user.getUserType()&&sdk.client.user.getLastLoginUserId()&&!e.isLastDoubleCheckReqValid()?(sdk.noop(),e.doubleCheck(function(t){return t||e._sendPopupFailInfo(8050),callback(t)})):callback(!0)):callback(!0)}}(this)),funcQueue.push(function(_this){return function(){var cb1,err,error,func,funcStr,name,timer;if(!_this.config._cond_func_async)return callback(!0);name=_this.config._name,cb1=null,timer=setTimeout(function(){return _this._sendPopupFailInfo(8073),cb1=sdk.noop,callback(!1)},3e4),cb1=function(e){return clearTimeout(timer),cb1=sdk.noop,e||_this._sendPopupFailInfo(8075),callback(!!e)};try{return funcStr="false||("+_this.config._cond_func_async+")",(func=eval(funcStr))(_this.config._id,_this.config._name,function(e){return cb1(e)})}catch(error){return err=error,sdk.noop(),_this._sendPopupFailInfo(8077),cb1(!1)}}}(this)),funcQueue.push(function(e){return function(){var t;return"custom_bubble"===e.config._template_type?callback(!0):(sdk.noop(),sdk.noop(),e.scene_shield_ratio?(t=sdk.util.collectProcessesInfo(),sdk.noop(),e._checkScene(msg,t,function(t){return t||e._sendPopupFailInfo(8080),callback(t)})):callback(!0))}}(this)),funcIndex=0,(callback=function(e){return function(e){return funcIndex>=funcQueue.length?cb&&cb(e):e?(funcIndex++,funcQueue[funcIndex-1]()):cb&&cb(e)}}(this))(!0)},BubbleCheck.prototype._string2InOutObj=function(e){var t,o,i,s,n,r,a,u;null==e&&(e=""),a=/^\-.*/;try{t=e.split(",")}catch(i){o=i,t=[]}for(r={"in":{},out:{}},s=0,n=t.length;s<n;s++)u=t[s],u=u.replace(/^\s/g,"").replace(/\s$/g,""),u&&(a.test(u)?r.out[u.replace(/^\-/,"")]=!0:r["in"][u.replace(/^\+/,"")]=!0);return r},BubbleCheck.prototype._ifInInOutObj=function(e,t){var o,i,s,n,r;for(r=this._string2InOutObj(e),n={},o=0,s=t.length;o<s;o++)i=t[o],n[i]=!0;for(i in r["in"])if(!n[i])return!1;for(i in r.out)if(n[i])return!1;return!0},BubbleCheck.prototype._ifValidReg=function(e){var t,o;o=this._string2InOutObj(e);for(t in o["in"])if(!sdk.system.existsRegKeyOrPath(t))return sdk.noop(),!1;for(t in o.out)if(sdk.system.existsRegKeyOrPath(t))return sdk.noop(),!1;return!0},BubbleCheck.prototype._inTimeSlot=function(){var e,t,o,i,s,n,r,a,u,c;if(s=sdk.util.getNow(),!this.timeSlot)return!0;for(r=15,n=.4,a=this.timeSlot.split(/[,|，|;]/),o=0,i=a.length;o<i;o++)if(u=a[o],c=u.split("-"),e=sdk.util.parseTime(c[0]),t=sdk.util.parseTime(c[1]),s>=e&&s<=t)return!(!(this instanceof CustomBubble)&&e.getHours()>=7&&e.getHours()<23&&s<e.getTime()+60*r*1e3)||Math.random()<n;return!1},BubbleCheck.prototype._ifConfigValid=function(cb){return sdk.util.ajax({url:"//pcfg.wps.cn/config/"+this._id+"/ifValid",type:"get",timeout:10,success:function(ret){var error,valid;sdk.noop();try{if(valid=eval("("+ret+")"),valid=valid.data)return cb(!0)}catch(error){sdk.noop()}return cb(!1)},error:function(e){return sdk.noop(),cb(!1)}})},BubbleCheck.prototype._checkScene=function(e,t,o){var i,s;return t.modelType=sdk.util.iniCache.get(this._id+"_modelType")||"lr_0",t.bubbleId=this._id,t.shieldingRatio=this.scene_shield_ratio,s="http://bubble-api.ksord.com/api/v1/bubble",sdk.noop(),sdk.noop(),i=.01,Math.random()<i&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/scene/"+this._id+"/"+i+"/0"),sdk.util.httpPost(s,t,function(e){var t,i;try{return sdk.noop(),sdk.noop(),e=JSON.parse(e),o("200"===e.status&&1===e.score?!0:!1)}catch(i){return t=i,sdk.noop(),sdk.noop(),o(!1)}},function(e){return sdk.noop(),sdk.noop(),o(!1)},5)},BubbleCheck.prototype.initReport=function(){return sdk.service.info.bubbleInit(this._id,this.config.bubble_name)},BubbleCheck}(BubbleBase),window.BubbleCheck=BubbleCheck}.call(this),function(){var e,t=function(e,t){function i(){this.constructor=e}for(var s in t)o.call(t,s)&&(e[s]=t[s]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},o={}.hasOwnProperty;e=function(e){function o(e){this.config=e,o.__super__.constructor.call(this,this.config),this.alive=!1,this._backupGlobalLastExecDate()}return t(o,e),o}(BubbleBase),window.BubbleView=e}.call(this),function(){var CustomBubble,extend=function(e,t){function o(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;CustomBubble=function(superClass){function CustomBubble(e){this.config=e,CustomBubble.__super__.constructor.call(this,this.config),this.script=this.config.script||"function(){}"}return extend(CustomBubble,superClass),CustomBubble.prototype.exec=function(){var bubbleId,bubbleName,err,error,jsStr;CustomBubble.__super__.exec.apply(this,arguments),this.executing=!0,this.recordPopup(),bubbleId=this._id,bubbleName=this.config._name;try{jsStr="("+this.script+")('"+bubbleId+"','"+bubbleName+"')",eval(jsStr)}catch(error){err=error,sdk.noop()}finally{this.destroy()}return sdk.service.info.popup(bubbleId,bubbleName,null,null,!0),this.executing=!1},CustomBubble}(BubbleCheck),window.CustomBubble=CustomBubble}.call(this),function(){var e,t=function(e,t){function i(){this.constructor=e}for(var s in t)o.call(t,s)&&(e[s]=t[s]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},o={}.hasOwnProperty;e=function(e){function o(e){this.config=e,o.__super__.constructor.call(this,this.config),"shopping_guide"===this.config.purpose&&(this.globalTimeInterval=6e4*(this.config._adSpecial_time_interval-0)||config.intervalBetweenTwoBubbles)}return t(o,e),o.prototype.isValid=function(e,t){var i,s,n;return!!sdk.client.info.skipClientFilter()||("shopping_guide"===this.config.purpose||(sdk.client.plugin.bubbleDisabled()&&"wps_upgrade"!==this.config._group_name?(this._sendPopupFailInfo(1020),!1):/00020\.00002578|00020\.00002579|00020\.00002642/.test(sdk.client.info.getDistNum())?(sdk.noop(),this._sendPopupFailInfo(1040),!1):sdk.client.info.isSpecDistNewUser()?(sdk.noop(),this._sendPopupFailInfo(1060),!1):this.exceptSeriousScene&&sdk.bubble.blockSeriousScene(this.exceptSeriousScene,sdk.bubble.inSeriousScene())?(this._sendPopupFailInfo(1070),!1):!this.config._group_name&&(i=sdk.system.getReg("freedom","HKEY_CURRENT_USER\\Software\\kingsoft\\Office\\6.0\\plugins\\kbubble")-0,s=new Date-0,s>=i&&s<i+3e5)?(this._sendPopupFailInfo(1080),!1):(n=sdk.util.formatDate(sdk.util.getNow(),"yyyy_MM_dd"),n>="2020_05_25"&&n<="2020_06_20"&&!/wps-电商-导购/i.test(this.config._name)&&!sdk.tools.d20618.checkTodayALL()?(this._sendPopupFailInfo(3090),!1):!!o.__super__.isValid.call(this,e,t))))},o.prototype.stop=function(){return this._rollbackGlobalLastExecDate(),this.alive=!1},o.prototype.exec=function(e){var t;return o.__super__.exec.apply(this,arguments),this._backupGlobalLastExecDate(),sdk.bubble.setGlobalLastExecDate(),"bind"!==sdk.mode&&this.putInBubbleInfo(),t="wps_exec_view/"+e,service.agent.launchWpsInfoExe(t)},o.prototype.tryExec=function(e,t){var o,i;return o=sdk.tools.observer.on(e+"_show",function(i){return function(){return i._sendPopupFailInfo(9070),sdk.tools.observer.clean(o),sdk.tools.observer.on(e+"_destroy",function(){return i.destroy()}),t&&t(!0)}}(this)),i=sdk.tools.observer.on(e+"_stop",function(e){return function(){return e.stop(),e._sendPopupFailInfo(9050),sdk.tools.observer.clean(i),t&&t(!1)}}(this)),this.exec(e)},o}(BubbleCheck),window.NormalBubble=e}.call(this),function(){var NormalBubbleView,appName,extend=function(e,t){function o(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;appName=sdk.client.info.getAppName(),NormalBubbleView=function(superClass){function NormalBubbleView(e){return NormalBubbleView.__super__.constructor.call(this,e),this.retryNum=0,this.script_after_close=e.script_after_close,this.afterCreateFunc=this.config._after_create_func||"function(){return true}",this.afterExecFunc=this.config._after_exec_func||"function(){return true}","bind"!==sdk.mode&&this.takeOutBubbleInfo(),!0}return extend(NormalBubbleView,superClass),NormalBubbleView.prototype.tryExec=function(e){var t,o,i;return t=this._id,o=sdk.tools.observer.on(t+"_show",function(t){return function(){return sdk.tools.observer.clean(o),e&&e(!0)}}(this)),i=sdk.tools.observer.on(t+"_stop",function(t){return function(){return t.close(constant.TYPE_CLOSE_BY_WEBVIEW_STOP),sdk.tools.observer.clean(i),e&&e(!1)}}(this)),this.exec()},NormalBubbleView.prototype.parseContentConfig=function(){var e,t,o,i,s,n,r,a,u,c,l;if(n=0,a=0,l=this.config.frame_width||"",o=this.config.frame_height||"",u=this.config.frame_url,e=null,"undefined"!=typeof this.config.abTest_popup_max&&(c=u.split("\n"),c.length>1)){t=parseInt(sdk.client.info.getHdid().substr(0,2),16)%c.length;try{e=c[t].match(/([a-zA-Z0-9]{32})/)[1]}catch(d){e=""}u=sdk.util.createGetUrl(c[t],{bubble_testId:e})}return r=sdk.util.getUrlParam("bubble_wh",u),r&&(i=r.indexOf("_"))>-1&&(l=r.substr(0,i),o=r.substr(i+1)),i=l.indexOf("~"),i>-1&&(n=l.substr(i+1),l=l.substr(0,i)),i=o.indexOf("~"),i>-1&&(a=o.substr(i+1),o=o.substr(0,i)),sdk.noop(),sdk.noop(),s={isAd:this.config.is_ad||0,traceProbability:this.config.trace_probability,substanceGroup:this.config._substance_group},e&&(s.abTestId=e),this.setBubbleInfo(s),{width:l,height:o,url:u,bubbleTestId:e,leftMargin:n,topMargin:a}},NormalBubbleView.prototype.exec=function(){var bubbleId,bubbleName,content,err,error,error1,execFunc,view;NormalBubbleView.__super__.exec.apply(this,arguments);try{if(this.executing=!0,this.alive=!1,bubbleId=this._id,bubbleName=this.config._name,content=this.parseContentConfig(),this.view=view=sdk.client.webview.generateRightBottomBubble(content.width,content.height,content.url,bubbleId,bubbleName,this.config.link_click_auto_close,this.autoCloseTimeout,sdk.noop,function(e){return function(){return e.alive=!0}}(this),function(e){return function(){return e._resetContinueCloseNum()}}(this),this.config.syncCookieDomainList,this.config.class_name||"",this.winFlag||""),this.config.hasOwnProperty("drag_left")&&this.view.setDragArea(this.config.drag_left,this.config.drag_top,this.config.drag_right,this.config.drag_bottom),this.setBubbleMsgId(),(content.leftMargin||content.topMargin)&&this.enableWindowProtection(content.leftMargin,content.topMargin),this.setWindowShieldCallback(),this.enableWindowProtectionNotify(),this.heartbeatToken=sdk.tools.observer.on(bubbleId+"_heartbeat",function(e){return function(){var t;return t=setInterval(function(){var o;if(o=new Date,sdk.noop(),e.alive&&e.visible&&o-e.lastBeat>3e4&&(e.close(constant.TYPE_CLOSE_BY_NON_HEARTBEAT),sdk.util.justSend("http://pcfg.wps.cn:9002/report/error/forceClosed/"+bubbleId+"/"+bubbleName+"/"+appName+"/"+e.retryNum),clearInterval(t)),!e.alive)return clearInterval(t)},1e4),e.lastBeat=new Date,function(){return e.lastBeat=new Date}}}(this)()),this.showToken=sdk.tools.observer.on(bubbleId+"_show",function(_this){return function(){return _this.showTimeout=setTimeout(function(){return _this.retryNum++,_this.executing=!1,sdk.util.justSend("http://pcfg.wps.cn:9002/report/error/showFailed/"+bubbleId+"/"+bubbleName+"/"+appName+"/"+_this.retryNum),_this.retryNum<=3?(sdk.noop(),_this.close(constant.TYPE_CLOSE_BY_RETRY),_this.exec()):(sdk.noop(),_this.close(constant.TYPE_CLOSE_BY_FORCE),_this._rollbackGlobalLastExecDate())},18e4),setTimeout(function(){if(_this.showTimeout)return _this.executing=!1,sdk.noop(),_this.close(constant.TYPE_CLOSE_BY_FORCE),_this._rollbackGlobalLastExecDate()},6e5),function(){var date,err,error,execFn,execFunc,today,zOrder;clearTimeout(_this.showTimeout),delete _this.showTimeout,window.config.overlayKilled&&_this.overlayGroup&&(sdk.noop(),sdk.tools.observer.fire("overlayGroupInfo",_this._id,_this.overlayGroup)),window.config.overlayKillAll&&(sdk.noop(),sdk.tools.observer.fire("killOthers",_this._id)),date=sdk.util.getNow()-0,execFn="var value = document.getElementById('close-btn'); if(value && value.offsetWidth){ sdk.util.iniCache.set('cCloseBtnSize', value.offsetWidth); }",sdk.client.webview.execute(_this.view.id,execFn),
zOrder=_this.setSeriousSceneZOrder(),sdk.service.info.popup(bubbleId,bubbleName,content.bubbleTestId),sdk.tools.storage.set(constant.STORAGE_KEY_BUBBLE_DATE_POPUP,date,_this.storageKeyGroup),_this.recordPopup(),_this.is_ad&&sdk.bubble.addGlobalLastMonthPopupNum(),today=sdk.util.formatDate(sdk.util.getNow(),"yyyy_MM_dd"),today>="2020_05_25"&&today<="2020_06_20"&&!/wps-电商-导购/i.test(bubbleName)&&sdk.tools.d20618.addTodayALL(),setTimeout(function(){var e;return e=_this.view.isHidden(),sdk.noop(),_this.alive&&!_this.hideIn&&e?(sdk.tools.observer.fire("isHidden",bubbleId,_this.view.id,e),sdk.service.info.hidden(bubbleId,bubbleName,e),_this.close(constant.TYPE_CLOSE_BY_HIDDEN)):(date=sdk.util.getNow(),_this.is_ad&&sdk.bubble.addGlobalLastMonthAdNum(date),_this.is_ad&&sdk.bubble.setGlobalLastExecAdTime(date),_this.is_ad&&sdk.bubble.addMiniLastMonthAdNum(date,_this.config.have_priority),sdk.bubble.addRecentPopup(bubbleId,bubbleName,date))},window.config.bubble_is_hidden_timeout);try{execFunc=eval("(function() {return "+_this.afterExecFunc+"})()"),execFunc(bubbleId,bubbleName,_this)}catch(error){err=error,sdk.noop()}return _this.view.show(zOrder),_this.executing=!1,_this.visible=!0}}}(this)()),this.waitToken=sdk.tools.observer.on(bubbleId+"_wait",function(e){return function(){return sdk.noop(),clearTimeout(e.showTimeout)}}(this)),this.closeToken=sdk.tools.observer.on("window_close",function(_this){return function(id,type){var err,error;if(null==type&&(type=2),sdk.noop(),type===constant.TYPE_CLOSE_BY_MIDNIGHT_RELOAD||type===constant.TYPE_CLOSE_BY_MENU_QUIT||type===constant.TYPE_CLOSE_BY_MENU_SILENCE)return sdk.noop(),_this.close(type);if(view.id===id||bubbleId===id){if(type!==constant.TYPE_CLOSE_BY_CLOSE_BTN&&type!==constant.TYPE_CLOSE_BY_NORMAL_CLICK_EVENT&&type!==constant.TYPE_CLOSE_BY_NOT_INTERESTED&&type!==constant.TYPE_CLOSE_BY_VIP_GUIDE||sdk.bubble.setGlobalLastClickTime(),_this.script_after_close)try{eval("("+_this.script_after_close+")('"+bubbleId+"', '"+bubbleName+"', "+type+")")}catch(error){err=error,sdk.noop()}return _this.close(type)}}}(this)),this.hideToken=sdk.tools.observer.on("window_hide_"+view.id,function(e){return function(){return e.hideIn=!0,view.hide()}}(this)),this.resizeToken=sdk.tools.observer.on("window_resize_"+view.id,function(e){return function(e,t){return view.resize(e,t),view.moveToRightBottom()}}(this)),this.moveToken=sdk.tools.observer.on("window_move_"+view.id,function(e){return function(e,t){return view.move(e,t)}}(this)),this.setDragAreaToken=sdk.tools.observer.on("window_setDragArea_"+view.id,function(e){return function(e,t,o,i){return view.setDragArea(e,t,o,i)}}(this)),this.setDragAreaExToken=sdk.tools.observer.on("window_setDragAreaEx_"+view.id,function(e){return function(t,o,i,s){return e.setDragAreaEx(t,o,i,s)}}(this)),sdk.noop(),this.autoCloseToken=setTimeout(function(e){return function(){if(e.view.valid())return e.view.isVisible()?(sdk.util.justSend("http://pcfg.wps.cn:9002/report/config/"+bubbleId+"/visible"),sdk.noop()):(sdk.util.justSend("http://pcfg.wps.cn:9002/report/config/"+bubbleId+"/hidden"),sdk.noop()),e.close(constant.TYPE_CLOSE_BY_TIMEOUT)}}(this),this.autoCloseTimeout),this.afterCreateFunc)try{return(execFunc=eval("(function() {return "+this.afterCreateFunc+"})()"))(this._id,this.config._name,this)}catch(error){return err=error,sdk.noop()}}catch(error1){return err=error1,sdk.noop()}},NormalBubbleView.prototype._ifViewExist=function(e){return this.view?e():setTimeout(function(t){return function(){if(t.view)return e()}}(this),1)},NormalBubbleView.prototype.setSeriousSceneZOrder=function(){var e,t;return e="0;1;2;3;4;5;6",t=sdk.bubble.blockSeriousScene(e,sdk.bubble.inSeriousScene())?0:100,t=sdk.system.isAnyProcessFullScreen()?0:t,this.setBubbleInfo({zOrder:t}),t},NormalBubbleView.prototype.setDragAreaEx=function(e,t,o,i,s){return this._ifViewExist(function(n){return function(){return s=s||function(){var e;if(sdk.noop(),e=1,1===Math.ceil(Math.random()/e))return sdk.service.info.sendStatistics({action:"window_dragged",probability:e,bubbleId:n._id})},n.view.setDragAreaEx(e,t,o,i,s)}}(this))},NormalBubbleView.prototype.setBubbleMsgId=function(e){return null==e&&(e=null),e="feature"===this.config.purpose?window.constant.FEATURE_WINDOW_PREFIX:window.constant.AD_WINDOW_TITLE,this._ifViewExist(function(t){return function(){return t.view.setBubbleMsgId("",e)}}(this))},NormalBubbleView.prototype.setBubbleTitle=function(e){return this._ifViewExist(function(t){return function(){return t.view.setBubbleTitle(e)}}(this))},NormalBubbleView.prototype.enableWindowProtection=function(e,t){return this._ifViewExist(function(o){return function(){return o.view.enableWindowProtection(e,t)}}(this))},NormalBubbleView.prototype.enableWindowProtection2=function(){return this._ifViewExist(function(e){return function(){return e.view.enableWindowProtection2(function(t){var o;if(sdk.noop(),o=.1,1===Math.ceil(Math.random()/o))return sdk.util.justSend("http://pcfg.wps.cn:9002/report/window_capped/"+e._id+"/"+o+"/"+t)})}}(this))},NormalBubbleView.prototype.enableWindowProtection3=function(){return this._ifViewExist(function(e){return function(){return e.view.enableWindowProtection3()}}(this))},NormalBubbleView.prototype.setWindowShieldCallback=function(e){return this._ifViewExist(function(t){return function(){var o;return o=0,e=e||function(e){var i;if(o++,sdk.noop(),i=.1,1===Math.ceil(Math.random()/i)&&(sdk.util.justSend("http://pcfg.wps.cn:9002/config/info/window-shield/"+t._id+"/"+i+"/"+sdk.service.info.getUserAsInfo()),sdk.service.info.sendStatistics({action:"window-shield",probability:i,bubbleId:t._id,as:sdk.service.info.getUserAsInfo()})),o>2)return t.close(constant.TYPE_CLOSE_BY_AS_HIDDEN)},t.view.setWindowShieldCallback(e)}}(this))},NormalBubbleView.prototype.enableWindowProtectionNotify=function(){return this._ifViewExist(function(e){return function(){var t;return t=t||function(t){var o;if(sdk.noop(),o=1,1===Math.ceil(Math.random()/o))return sdk.util.justSend("http://pcfg.wps.cn:9002/config/info/add-hat/"+e._id+"/"+o+"/"+sdk.service.info.getUserAsInfo()),sdk.service.info.sendStatistics({action:"add-hat",probability:o,bubbleId:e._id,as:sdk.service.info.getUserAsInfo()})},e.view.enableWindowProtectionNotify(t)}}(this))},NormalBubbleView.prototype.enableWindowHoverProtection=function(e){return this._ifViewExist(function(t){return function(){return e=e||function(){var e;if(sdk.noop(),t.close(constant.TYPE_CLOSE_BY_TRY_CLICK_HAT),e=1,1===Math.ceil(Math.random()/e))return sdk.util.justSend("http://pcfg.wps.cn:9002/config/info/try-click-hat/"+t._id+"/"+e+"/"+sdk.service.info.getUserAsInfo()),sdk.service.info.sendStatistics({action:"try-click-hat",bubbleId:t._id,probability:e,as:sdk.service.info.getUserAsInfo()})},t.view.enableWindowHoverProtection(e)}}(this))},NormalBubbleView.prototype.enableWindowHoverProtection2=function(e){return this._ifViewExist(function(t){return function(){return e=e||function(){var e;if(sdk.noop(),t.close(constant.TYPE_CLOSE_BY_TRY_CLICK_HAT),e=1,1===Math.ceil(Math.random()/e))return sdk.util.justSend("http://pcfg.wps.cn:9002/config/info/try-click-hat/"+t._id+"/"+e+"/"+sdk.service.info.getUserAsInfo()),sdk.service.info.sendStatistics({action:"try-click-hat",bubbleId:t._id,probability:e,as:sdk.service.info.getUserAsInfo()})},t.view.enableWindowHoverProtection2(e)}}(this))},NormalBubbleView.prototype.enableAutoActiveBubble=function(e){var t,o;return null==e&&(e=10),o=0,t=function(e){return function(){var t;if(!e.view.isBubbleActive())if(sdk.noop(),o<5){if(e.view.activeBubble(),o++,t=.1,1===Math.ceil(Math.random()/t))return sdk.util.justSend("http://pcfg.wps.cn:9002/config/info/active-bubble/"+e._id+"/"+t+"/"+o),sdk.service.info.sendStatistics({action:"active-bubble",bubbleId:e._id,probability:t,num:o})}else if(e.autoActiveToken)return clearInterval(e.autoActiveToken),e.autoActiveToken=null}}(this),this._ifViewExist(function(o){return function(){return o.autoActiveToken=setInterval(function(){return t()},1e3*e)}}(this))},NormalBubbleView.prototype.close=function(e){switch(sdk.noop(),this.executing=!1,this.alive=!1,e){case constant.TYPE_CLOSE_BY_CLOSE_BTN:case constant.TYPE_CLOSE_BY_NOT_INTERESTED:case constant.TYPE_CLOSE_BY_VIP_GUIDE:this._addContinueCloseNum(),sdk.noop();break;case constant.TYPE_CLOSE_BY_NORMAL_CLICK_EVENT:this._resetContinueCloseNum(),sdk.noop();break;default:sdk.noop()}return e!==constant.TYPE_CLOSE_BY_NORMAL_CLICK_EVENT&&e!==constant.TYPE_CLOSE_BY_RETRY&&e!==constant.TYPE_CLOSE_BY_HIDDEN&&sdk.service.info.close(this._id,this.config._name,this.view.getAliveTime(),e),sdk.tools.storage.set(constant.STORAGE_KEY_BUBBLE_DATE_CLOSE,sdk.util.getNow()-0,this.storageKeyGroup),sdk.tools.storage.set(constant.STORAGE_KEY_BUBBLE_CLOSE_TYPE,e,this.storageKeyGroup),sdk.bubble.addRecentClose(this._id,this.config._name,e,sdk.util.getNow()-0),this.showTimeout&&e!==constant.TYPE_CLOSE_BY_RETRY&&(clearTimeout(this.showTimeout),this.showTimeout=null),this.autoCloseToken&&(clearTimeout(this.autoCloseToken),this.autoCloseToken=null),this.view.destroy(),this.destroy(),this.observer.fire("close",e)},NormalBubbleView.prototype.destroy=function(){if(NormalBubbleView.__super__.destroy.apply(this,arguments),this.showToken&&sdk.tools.observer.clean(this.showToken),this.heartbeatToken&&sdk.tools.observer.clean(this.heartbeatToken),this.closeToken&&sdk.tools.observer.clean(this.closeToken),this.waitToken&&sdk.tools.observer.clean(this.waitToken),this.hideToken&&sdk.tools.observer.clean(this.hideToken),this.resizeToken&&sdk.tools.observer.clean(this.resizeToken),this.moveToken&&sdk.tools.observer.clean(this.moveToken),this.setDragAreaToken&&sdk.tools.observer.clean(this.setDragAreaToken),this.setDragAreaExToken&&sdk.tools.observer.clean(this.setDragAreaExToken),this.autoActiveToken)return clearInterval(this.autoActiveToken),this.autoActiveToken=null},NormalBubbleView}(BubbleView),window.NormalBubbleView=NormalBubbleView}.call(this),function(){var MaterialBubble,extend=function(e,t){function o(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;MaterialBubble=function(superClass){function MaterialBubble(){return MaterialBubble.__super__.constructor.apply(this,arguments)}return extend(MaterialBubble,superClass),MaterialBubble.prototype.isValid=function(e,t){return!!MaterialBubble.__super__.isValid.call(this,e,t)&&(!!sdk.bubble.ifMatchMaterial(t,this._id)||(this._sendPopupFailInfo(7090),!1))},MaterialBubble.prototype.tryExec=function(e,t){return sdk.util.generateAesKey()instanceof Error?this.mtrV2(function(o){return function(i){return i?MaterialBubble.__super__.tryExec.call(o,e,t):(o._sendPopupFailInfo(9026),t(!1))}}(this)):this.mtrV3(function(o){return function(i){return i?MaterialBubble.__super__.tryExec.call(o,e,t):(o._sendPopupFailInfo(9023),t(!1))}}(this))},MaterialBubble.prototype.mtrV2=function(e){var t,o,i,s,n,r;if(r=sdk.bubble.getAllMatchTitles(this.getMsgGroupInfo(),sdk.bubble.getMaterialTagsFromIni(this._id)),!r)return e&&e(!1);r=r.substr(0,116),sdk.noop();try{s=new Date,n=sdk.util.rsaEncrypt(r),s=new Date-s,sdk.noop(),sdk.service.info.sendStatistics({action:"rsaEncrypt",probability:.01,value:1,len:Math.ceil(r.length/10),time:Math.ceil(s/10)})}catch(i){return o=i,sdk.noop(),sdk.service.info.sendStatistics({action:"rsaEncrypt",probability:.01,value:0,len:Math.ceil(r.length/10)}),e&&e(!1)}return t=sdk.util.decodeBase64(sdk.tools.storage.get("city")||""),sdk.util.ajax({url:"//pcfg.wps.cn/mtr/bs_v2",data:{hdid:sdk.client.info.getHdid()||"",title:encodeURIComponent(n),as:sdk.as.getAsProcess("id",";"),city:sdk.util.aesEncrypt(t)||t,bubble_id:this._id},type:"get",timeout:10,success:function(t){return function(o){return t.mtrReqSuc(o,e)}}(this),error:function(t){return this.mtrReqErr(t,e)}})},MaterialBubble.prototype.mtrV3=function(e){var t,o,i,s,n,r,a;if(r=sdk.util.generateAesKey(),a=sdk.bubble.getAllMatchTitles(this.getMsgGroupInfo(),sdk.bubble.getMaterialTagsFromIni(this._id)),!a)return e&&e(!1);sdk.noop();try{t=new Date,o=sdk.util.aesEncryptEx(r,a),r=sdk.util.rsaEncrypt(r),t=new Date-t,sdk.noop(),sdk.noop(),sdk.service.info.sendStatistics({action:"aesEncrypt",probability:.01,value:1,len:Math.ceil(a.length/10),time:Math.ceil(t/10)})}catch(n){return s=n,sdk.noop(),sdk.service.info.sendStatistics({action:"aesEncrypt",probability:.01,value:0,len:Math.ceil(a.length/10)}),e&&e(!1)}return i=sdk.util.decodeBase64(sdk.tools.storage.get("city")||""),sdk.util.ajax({url:"//pcfg.wps.cn/mtr/bs_v3",data:{hdid:sdk.client.info.getHdid()||"",title:encodeURIComponent(o),key:encodeURIComponent(r),as:sdk.as.getAsProcess("id",";"),city:sdk.util.aesEncrypt(i)||i,bubble_id:this._id},type:"get",timeout:10,success:function(t){return function(o){return t.mtrReqSuc(o,e)}}(this),error:function(t){return this.mtrReqErr(t,e)}})},MaterialBubble.prototype.mtrReqSuc=function(ret,cb){var err,error,mtr;if(sdk.noop(),!this.popupIntervalCheck())return cb&&cb(!1);try{if(mtr=eval("("+ret+")"),this.materialConfig=mtr.data,this.materialConfig)return this.materialConfig.info.substance_group&&this.materialConfig.info.substance_interval&&(this.substanceMutex=!0,!sdk.bubble.checkSubstanceMutex(this.materialConfig.info.substance_group,this.materialConfig.info.substance_interval))?cb&&cb(!1):(this.setBubbleInfo({mtr:sdk.util.serialize(this.materialConfig)}),cb&&cb(!0))}catch(error){err=error,sdk.noop()}return sdk.bubble.addMaterialFailedNum(),cb&&cb(!1)},MaterialBubble.prototype.mtrReqErr=function(e,t){return sdk.noop(),sdk.bubble.addMaterialFailedNum(),t&&t(!1)},MaterialBubble}(NormalBubble),window.MaterialBubble=MaterialBubble}.call(this),function(){var e,t=function(e,t){function i(){this.constructor=e}for(var s in t)o.call(t,s)&&(e[s]=t[s]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},o={}.hasOwnProperty;e=function(e){function o(e){var t;o.__super__.constructor.call(this,e),t=this.getBubbleInfo("mtr"),this.materialConfig=sdk.util.deserialize(t)}return t(o,e),o.prototype.parseContentConfig=function(){var e,t,o,i,s,n,r,a,u,c,l;if(n=0,a=0,l="",o="",u="",e=null,c=this.materialConfig.info?this.materialConfig.info.frame_url||[]:[],c.length>1){t=parseInt(sdk.client.info.getHdid().substr(0,2),16)%c.length;try{e=c[t].match(/([a-zA-Z0-9]{32})/)[1]}catch(d){e=""}u=sdk.util.createGetUrl(c[t],{bubble_testId:e})}else 1===c.length&&(u=c[0]);return r=sdk.util.getUrlParam("bubble_wh",u),r&&(i=r.indexOf("_"))>-1&&(l=r.substr(0,i),o=r.substr(i+1)),i=l.indexOf("~"),i>-1&&(n=l.substr(i+1),l=l.substr(0,i)),i=o.indexOf("~"),i>-1&&(a=o.substr(i+1),o=o.substr(0,i)),sdk.noop(),sdk.noop(),s={materialId:this.materialConfig._id,materialName:this.materialConfig.name,keyword:this.materialConfig.k_h?sdk.util.aesDecrypt(this.materialConfig.k_h):void 0,isAd:this.config.is_ad,traceProbability:this.config.trace_probability,substanceGroup:this.materialConfig.info.substance_group||this.config._substance_group},e&&(s.abTestId=e),this.setBubbleInfo(s),{width:l,height:o,url:u,bubbleTestId:e,leftMargin:n,topMargin:a}},o}(NormalBubbleView),window.MaterialBubbleView=e}.call(this),function(){var e,t=function(e,t){function i(){this.constructor=e}for(var s in t)o.call(t,s)&&(e[s]=t[s]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},o={}.hasOwnProperty;e=function(e){function o(e){o.__super__.constructor.call(this,{}),this.config._id=e,this.config._name=this.config._id,this.config.url=e}return t(o,e),o.prototype.isValid=function(){return!sdk.system.isProjectorConnected()||(sdk.noop(),!1)},o}(BubbleBase),window.MsgBubbleCheck=e}.call(this),function(){var MsgBubbleView,appName,extend=function(e,t){function o(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty,slice=[].slice;appName=sdk.client.info.getAppName(),MsgBubbleView=function(superClass){function MsgBubbleView(e){MsgBubbleView.__super__.constructor.call(this,{}),this.config._id=e,this.config._name=this.config._id,this.config.url=e}return extend(MsgBubbleView,superClass),MsgBubbleView.prototype.isValid=function(){return!sdk.system.isProjectorConnected()||(sdk.noop(),!1)},MsgBubbleView.prototype.isReady=function(){return!!this.ready},MsgBubbleView.prototype.isLoaded=function(){return!!this.loaded},MsgBubbleView.prototype.sendMessage=function(){var e,t,o,i;return e=1<=arguments.length?slice.call(arguments,0):[],this.connected?(i=e.shift(),t=sdk.util.encodeBase64(sdk.util.serialize(e)),o='sdk.tools.observer.fire("'+i+'", "'+t+'")',sdk.client.webview.execute(this.view.id,o),sdk.noop()):setTimeout(function(t){return function(){return t.sendMessage.apply(t,e)}}(this),1e3)},MsgBubbleView.prototype.exec=function(){var bubbleId,bubbleName,closeTimeout,closeWhenClick,domainList,handlerDestroy,handlerLinkClicked,handlerLoaded,height,serverTopview,url,width;return MsgBubbleView.__super__.exec.apply(this,arguments),this.recordPopup(),bubbleId=this.config._id,bubbleName=this.config._name,url=this.config.url,width=800,height=600,closeTimeout=864e5,closeWhenClick=!1,handlerDestroy=sdk.noop,handlerLoaded=function(e){return function(){return e.loaded=!0}}(this),handlerLinkClicked=sdk.noop,domainList=[],this.view=sdk.client.webview.generateRightBottomBubble(width,height,url,bubbleId,bubbleName,closeWhenClick,closeTimeout,handlerDestroy,handlerLoaded,handlerLinkClicked,domainList),this.channelView="view_"+this.view.id,serverTopview="bubble_service",this.setBubbleMsgId(),sdk.tools.observer.on(bubbleId+"_heartbeat",function(e){return function(){var t;return t=setInterval(function(){var o;if(o=new Date,e.alive&&e.visible&&o-e.lastBeat>1e4)return view.destroy(constant.TYPE_CLOSE_BY_FORCE,!1),sdk.util.justSend("http://pcfg.wps.cn:9002/report/error/forceClosed/"+bubbleId+"/"+bubbleName+"/"+appName+"/"+e.retryNum),clearInterval(t)},5e3),function(){return e.lastBeat=new Date}}}(this)()),sdk.tools.observer.on(""+this.channelView,function(_this){return function(argsb64){var action,args,b64,err,error,error1,params,server;try{args=eval("("+sdk.util.decodeBase64(argsb64)+")")}catch(error){err=error,args=[],sdk.noop()}if(server=args.shift()){if(server!==serverTopview)return params={url:_this.config.url,server:server,message:args[0]},b64=sdk.util.encodeBase64(sdk.util.serialize(params)),sdk.client.plugin.emit(server,b64),sdk.noop();try{return action=args.shift(),"show"===action?(_this.visible=!0,_this.view.show(),sdk.service.info.popup(bubbleId,bubbleName),sdk.tools.storage.set(constant.STORAGE_KEY_BUBBLE_DATE_POPUP,sdk.util.getNow()-0,_this.storageKeyGroup)):"destroy"===action?_this.close():"hide"===action?(_this.visible=!1,_this.view.hide()):"move"===action?_this.view.move.apply(_this.view,args):"resize"===action?_this.view.resize.apply(_this.view,args):"setOpacity"===action?_this.view.setOpacity.apply(_this.view,args):"setZOrder"===action?_this.view.setZOrder.apply(_this.view,args):"connected"===action&&(_this.connected=!0),sdk.noop()}catch(error1){return err=error1,sdk.noop()}}}}(this)),sdk.tools.observer.on("window_close",function(e){return function(t,o){return null==o&&(o=2),sdk.noop(),o===constant.TYPE_CLOSE_BY_FORCE?(e.close(o),void sdk.noop()):view.id===t||bubbleId===t?e.close(o):void 0}}(this))},MsgBubbleView.prototype.setBubbleMsgId=function(e){return null==e&&(e=window.constant.FEATURE_WINDOW_PREFIX),this.view.setBubbleMsgId("",e)},MsgBubbleView.prototype.close=function(e){return sdk.noop(),this.view.destroy(),sdk.tools.storage.set(constant.STORAGE_KEY_BUBBLE_DATE_CLOSE,sdk.util.getNow()-0,this.storageKeyGroup),this.observer.fire("close"),this.destroy()},MsgBubbleView}(BubbleView),window.MsgBubbleView=MsgBubbleView}.call(this),function(){var e,t=function(e,t){function i(){this.constructor=e}for(var s in t)o.call(t,s)&&(e[s]=t[s]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},o={}.hasOwnProperty;e=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return t(o,e),o.prototype.isValid=function(e,t){return sdk.client.webview.isSupportWebviewEx()?!!o.__super__.isValid.call(this,e,t):(sdk.noop(),!1)},o}(NormalBubble),window.NormalExBubble=e}.call(this),function(){var NormalExBubbleView,Win_Maximized,Win_Minimized,Win_Normal,extend=function(e,t){function o(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;Win_Normal=0,Win_Minimized=1,Win_Maximized=2,NormalExBubbleView=function(superClass){function NormalExBubbleView(e){NormalExBubbleView.__super__.constructor.call(this,e),this.winState=e.win_state||"",this.appId="Kingsoft.Office.KBubble."+Math.floor(1e4*Math.random()),this.appName="Kingsoft Office 推荐",sdk.client.webview.setCurrentProcessExplicitAppUserModelID(this.appId)}return extend(NormalExBubbleView,superClass),NormalExBubbleView.prototype.exec=function(){var e,t;try{return this.executing=!0,this.alive=!1,sdk.noop(),sdk.client.plugin.stopExit(),sdk.bubble.setGlobalLastExecDate(),this.setBubbleInfo({adType:this.getAdType()}),this.createWebviewState(),this.view.showWithoutActivating(),this.initReady=!1,this.bubbleReady=!1,this.bubbleWatch(function(e){return function(){var t,o;return 1===e.webviewSize.width&&1===e.webviewSize.height?(e.view.showMinimized(),e.view.flashWindowEx(6)):(e.winState===""+Win_Normal&&(o=sdk.util.iniCache.get(e._id+"_zOrder"),e.view.show(o)),e.winState===""+Win_Minimized&&(t=sdk.system.getScreenSize(),e.view.move(t.width+e.webviewSize.left,e.webviewSize.top),e.view.show(),setTimeout(function(){if(!e.bubbleReady)return e.view.showMinimized(),e.view.move(e.webviewSize.left,e.webviewSize.top),e.bubbleReady=!0},1200)),e.winState===""+Win_Maximized&&(e.view.setOpacity(1),e.view.showMaximized()),e.view.flashWindowEx(6))}}(this))}catch(t){return e=t,sdk.noop()}},NormalExBubbleView.prototype.createWebviewState=function(){var e,t,o,i,s,n,r,a,u,c,l,d,p,f,h,b;return s=this._id,n=this.config._name,a=this.parseContentConfig(),b=a.width-0,u=a.height-0,r=sdk.util.createGetUrl(a.url,{bubble_id:s,bubble_name:n}),l=sdk.system.getScreenPadding(),d=sdk.system.getScreenSize(),h=d.width-l.right-l.left,f=d.height-l.top-l.bottom,h<b&&(b=h),f<u&&(u=f),c=d.width-b-l.right-1,p=d.height-u-l.bottom,sdk.noop(),this.webviewSize={width:b,height:u,left:c,top:p},t=function(e){return function(){if(e.alive)return sdk.tools.observer.fire("window_close",e.view.id,constant.TYPE_CLOSE_BY_CLOSE_BTN)}}(this),i=function(e){return function(){return e.alive=!0}}(this),e=sdk.noop,this.view=sdk.client.webview.generateWebviewEx(r,b,u,c,p,t,i,e,this.config.syncCookieDomainList,this.config.class_name||""),(a.leftMargin||a.topMargin)&&this.enableWindowProtection(a.leftMargin,a.topMargin),o=function(e){return function(t,o){var i;if(e.alive)return e.bubbleReady||e.winState!==""+Win_Minimized||t!==Win_Normal||o!==Win_Minimized||(e.view.move(c,p),e.bubbleReady=!0),i="sdk.tools.observer.fire('"+s+"_statechange', "+t+", "+o+")",sdk.noop(),sdk.client.webview.execute(e.view.id,i)}}(this),this.view.setStateChangedCallback(o)},NormalExBubbleView.prototype.bubbleWatch=function(callback){var bubbleId,bubbleName,err,error,execFunc;if(bubbleId=this._id,bubbleName=this.config._name,this.enableWindowProtectionNotify(),this.hertbeatToken=sdk.tools.observer.on(bubbleId+"_heartbeat",function(e){return function(){var t;return t=setInterval(function(){var o;if(o=new Date,e.alive&&e.visible&&o-e.lastBeat>3e4)return e.close(constant.TYPE_CLOSE_BY_NON_HEARTBEAT),sdk.util.justSend("http://pcfg.wps.cn:9002/report/error/forceClosed/"+bubbleId+"/"+bubbleName+"/"+appName+"/"+e.retryNum),clearInterval(t)},1e4),e.lastBeat=new Date,function(){return e.lastBeat=new Date}}}(this)()),this.initToken=sdk.tools.observer.on(bubbleId+"_init",function(e){return function(t,o,i){return t&&o&&i||(e.initReady=!1),e.view.setBubbleTitle(t),e.view.setWindowIconByPath(o),e.view.setPropertyStoreForWindow(e.appId,e.appName,o),e.view.setIconicThumbnailByPath(i,180,100),e.initReady=!0}}(this)),this.showToken=sdk.tools.observer.on(bubbleId+"_show",function(_this){return function(){return _this.showTimeout=setTimeout(function(){return _this.retryNum++,sdk.util.justSend("http://pcfg.wps.cn:9002/report/error/showFailed/"+bubbleId+"/"+bubbleName+"/"+appName+"/"+_this.retryNum),_this.retryNum<=3?(_this.executing=!1,sdk.noop(),_this.close(constant.TYPE_CLOSE_BY_RETRY),_this.exec()):(_this.executing=!1,sdk.noop(),_this.close(constant.TYPE_CLOSE_BY_FORCE),_this._rollbackGlobalLastExecDate())},18e4),setTimeout(function(){if(_this.showTimeout)return _this.executing=!1,sdk.noop(),_this.close(constant.TYPE_CLOSE_BY_FORCE),_this._rollbackGlobalLastExecDate()},6e5),function(){var date,err,error,execFn,execFunc,seriousScene,today,zOrder;if(clearTimeout(_this.showTimeout),delete _this.showTimeout,!_this.initReady)return sdk.noop(),_this.close(constant.TYPE_CLOSE_BY_FORCE),void _this._rollbackGlobalLastExecDate();window.config.overlayKilled&&_this.overlayGroup&&(sdk.noop(),sdk.tools.observer.fire("overlayGroupInfo",bubbleId,_this.overlayGroup)),window.config.overlayKillAll&&(sdk.noop(),sdk.tools.observer.fire("killOthers",bubbleId)),date=sdk.util.getNow()-0,execFn="var value = document.getElementById('close-btn'); if(value && value.offsetWidth){ sdk.util.iniCache.set('cCloseBtnSize', value.offsetWidth); }",sdk.client.webview.execute(_this.view.id,execFn),seriousScene="0;1;2;3;4;5;6",zOrder=sdk.bubble.blockSeriousScene(seriousScene,sdk.bubble.inSeriousScene())?0:100,zOrder=sdk.system.isAnyProcessFullScreen()?0:zOrder,_this.setBubbleInfo({zOrder:zOrder}),sdk.service.info.popup(bubbleId,bubbleName,""),sdk.tools.storage.set(constant.STORAGE_KEY_BUBBLE_DATE_POPUP,date,_this.storageKeyGroup),_this.recordPopup(),_this.is_ad&&sdk.bubble.addGlobalLastMonthPopupNum(),today=sdk.util.formatDate(sdk.util.getNow(),"yyyy_MM_dd"),today>="2020_05_25"&&today<="2020_06_20"&&!/wps-电商-导购/i.test(bubbleName)&&sdk.tools.d20618.addTodayALL(),callback&&callback();try{execFunc=eval("(function() {return "+_this.afterExecFunc+"})()"),execFunc(bubbleId,bubbleName,_this)}catch(error){err=error,sdk.noop()}return setTimeout(function(){var e;return e=_this.view.isHidden(),sdk.noop(),_this.alive&&e?(sdk.tools.observer.fire("isHidden",bubbleId,_this.view.id,e),sdk.service.info.hidden(bubbleId,bubbleName,e),_this.close(constant.TYPE_CLOSE_BY_HIDDEN)):(date=sdk.util.getNow(),_this.is_ad&&sdk.bubble.addGlobalLastMonthAdNum(date),_this.is_ad&&sdk.bubble.setGlobalLastExecAdTime(date),_this.is_ad?sdk.bubble.addMiniLastMonthAdNum(date,_this.config.have_priority):void 0)},1e4),_this.executing=!1,_this.visible=!0}}}(this)()),sdk.tools.observer.on(bubbleId+"_wait",function(e){return function(){return sdk.noop(),clearTimeout(e.showTimeout)}}(this)),this.closeToken=sdk.tools.observer.on("window_close",function(_this){return function(id,type){var err,error;if(null==type&&(type=2),sdk.noop(),type===constant.TYPE_CLOSE_BY_MIDNIGHT_RELOAD)return _this.close(type),void sdk.noop();if(_this.view.id===id||bubbleId===id){if(type!==constant.TYPE_CLOSE_BY_CLOSE_BTN&&type!==constant.TYPE_CLOSE_BY_NORMAL_CLICK_EVENT||sdk.bubble.setGlobalLastClickTime(),_this.script_after_close)try{eval("("+_this.script_after_close+")('"+bubbleId+"', '"+bubbleName+"', "+type+")")}catch(error){err=error,sdk.noop()}return _this.close(type)}}}(this)),sdk.tools.observer.on("window_hide_"+this.view.id,function(e){return function(){return e.view.hide()}}(this)),sdk.noop(),setTimeout(function(e){return function(){if(e.view.valid())return e.view.isVisible()?(sdk.util.justSend("http://pcfg.wps.cn:9002/report/config/"+bubbleId+"/visible"),sdk.noop()):(sdk.util.justSend("http://pcfg.wps.cn:9002/report/config/"+bubbleId+"/hidden"),sdk.noop()),e.close(constant.TYPE_CLOSE_BY_TIMEOUT)}}(this),this.autoCloseTimeout),this.afterCreateFunc)try{return(execFunc=eval("(function() {return "+this.afterCreateFunc+"})()"))(bubbleId,bubbleName,this)}catch(error){return err=error,sdk.noop()}},NormalExBubbleView}(NormalBubbleView),window.NormalExBubbleView=NormalExBubbleView}.call(this),function(){var BUBBLE_INTERVAL,ShoppingBubble,extend=function(e,t){function o(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;BUBBLE_INTERVAL=6e4,ShoppingBubble=function(superClass){function ShoppingBubble(e){ShoppingBubble.__super__.constructor.call(this,e),"shopping_guide"===this.config.purpose?this.globalTimeInterval=0:this.globalTimeInterval=6e4*(this.config._adSpecial_time_interval-0)||BUBBLE_INTERVAL}return extend(ShoppingBubble,superClass),ShoppingBubble.prototype.isValid=function(msg,info){var condRet,err,error,func,funcStr,now;if(now=sdk.util.getNow(),this.failedReason=0,"tray_icon_3"===msg&&(sdk.util.justSend("http://pcfg.wps.cn:9002/report/trace/recommend_popup/"+info+"/isValid"),sdk.util.justSend("http://log.u.wps.cn/v0/api/visit/trace/recommend_popup/"+info+"/isValid")),!sdk.client.trayicon.isSupport())return sdk.noop(),!1;if(!sdk.client.trayicon.isSubscribe())return sdk.noop(),!1;if(sdk.client.trayicon.isExit())return sdk.noop(),!1;if("shopping_guide"===this.config.purpose)return sdk.noop(),!0;if(this.alive)return sdk.noop(),!1;if(sdk.client.trayicon.isSilence())return sdk.noop(),!1;if(sdk.system.isAnyProcessFullScreen()||sdk.system.isProjectorConnected())return sdk.noop(),!1;if(!this.popupIntervalCheck())return!1;if(!this.clickIntervalCheck())return!1;if(!sdk.bubble.isTimeEffect(this.timeEffect))return sdk.noop(),!1;if(!this._inTimeSlot())return sdk.noop(),!1;if(this.config._substance_group&&this.config._substance_interval&&(this.substanceMutex=!0,!sdk.bubble.checkSubstanceMutex(this.config._substance_group,this.config._substance_interval)))return sdk.noop(),!1;if(this._getExecNumToday()>=this.maxNumaDay)return sdk.noop(),!1;if(this._getExecNumTotal()>=this.maxNum)return sdk.noop(),!1;if(0===this.enabled)return sdk.noop(),!1;if(this.exceptPaidUser&&sdk.client.user.isPaidUser())return sdk.noop(),!1;if(this.exceptPaidUser&&sdk.client.info.isEduVersion())return sdk.noop(),!1;if(this.exceptPaidUser&&sdk.client.user.isComplainedUser())return sdk.noop(),!1;if(this.shieldInterceptor&&sdk.util.indexOf("qg",sdk.as.getAsProcess("name"))>-1&&sdk.as.existInterceptionRule("qg"))return sdk.noop(),!1;if(this.softList&&!this._ifInInOutObj(this.softList,sdk.system.listSoftWare()))return sdk.noop(),!1;if(!this._ifInInOutObj(this.processList,sdk.system.listProcesses()))return sdk.noop(),!1;if(!this._ifInInOutObj(this.desktopLinks,sdk.system.listDesktopLinks()))return sdk.noop(),!1;if(!this._ifInInOutObj(this.taskbarLinks,sdk.system.listTaskbarLinks()))return sdk.noop(),!1;if(!this._ifValidReg(this.regList))return sdk.noop(),!1;try{funcStr="false||("+this.condFunc+")",func=eval(funcStr),condRet=func(this.config._id,this.config._name,msg,info)}catch(error){err=error,sdk.noop(),condRet=!1}finally{if(!condRet)return sdk.noop(),!1}return!0},ShoppingBubble}(NormalBubble),window.ShoppingBubble=ShoppingBubble}.call(this),function(){var e,t,o=function(e,t){function o(){this.constructor=e}for(var s in t)i.call(t,s)&&(e[s]=t[s]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},i={}.hasOwnProperty;t=sdk.client.info.getAppName(),e=function(e){function t(e){t.__super__.constructor.call(this,e)}return o(t,e),t.prototype.exec=function(){var e,o,i;return t.__super__.exec.apply(this,arguments),o=this.getBubbleInfo("msg"),e=this.getBubbleInfo("msgInfo"),"tray_icon_3"===o&&(sdk.util.justSend("http://pcfg.wps.cn:9002/report/trace/recommend_popup/"+e+"/exec"),sdk.util.justSend("http://log.u.wps.cn/v0/api/visit/trace/recommend_popup/"+e+"/exec"),i=sdk.tools.observer.on(this._id+"_show",function(t){return function(){return sdk.tools.observer.clean(i),sdk.util.justSend("http://pcfg.wps.cn:9002/report/trace/recommend_popup/"+e+"/popup"),sdk.util.justSend("http://log.u.wps.cn/v0/api/visit/trace/recommend_popup/"+e+"/popup");
}}(this))),this.setVisibleChangedCallback(),this.setBubbleTitle("广告"),this.moveWithTrayToken=sdk.tools.observer.on("window_moveWithTray_"+this.view.id,function(e){return function(t,o){var i,s,n,r,a;return a=sdk.client.trayicon.getTrayIconPosition(),s=sdk.system.getScreenSize(),n=sdk.system.getTaskbarSize(),i=0,r=0,a.x+t>s.width?(i=s.width-t-1,n.tw<s.width/4&&(i-=n.tw)):(i=a.x+1,n.tw<s.width/4&&(i+=n.tw)),a.y+o>s.height?(r=s.height-o-1,n.th<s.height/4&&(r-=n.th)):(r=a.y,n.th<s.height/4&&(r+=n.th)),sdk.noop(),e.view.move(i,r)}}(this))},t.prototype.setSeriousSceneZOrder=function(){var e;return e=100,this.setBubbleInfo({zOrder:e}),e},t.prototype.setVisibleChangedCallback=function(e){return this._ifViewExist(function(t){return function(){return e=e||function(e){if(t.alive&&"hidden"===e)return sdk.noop(),t.close(constant.TYPE_CLOSE_BY_OUTER_MSG)},t.view.setVisibleChangedCallback(e)}}(this))},t.prototype.destroy=function(){return this.moveWithTrayToken&&sdk.tools.observer.clean(this.moveWithTrayToken),t.__super__.destroy.apply(this,arguments)},t}(NormalBubbleView),window.ShoppingBubbleView=e}.call(this),function(){var appName,cfgParseDecrypt,cleanIniInterval,configLoadPath,configPath,configService,keyCityBase64,keyConfigList,keyConfigListBase64,keyConfigListLength,keyTimeLastCleanConfig,keyTimeLastLoadCity,keyTimeLastLoadConfig,keyTimeLastModifyConfig,loadCityInterval,loadConfigInterval,storage;keyTimeLastLoadCity="time_last_load_city",keyCityBase64="city",keyTimeLastLoadConfig="time_last_load_config",keyTimeLastModifyConfig="time_last_modify_config",keyTimeLastCleanConfig="time_last_clean_config",keyConfigListBase64="config_list",loadCityInterval=6048e5,loadConfigInterval=36e5,cleanIniInterval=24*Math.floor(7*Math.random()+3)*36e5,keyConfigList="config",keyConfigListLength="config_len",appName=sdk.client.info.getAppName(),storage=sdk.tools.storage,configLoadPath={"":"/config/pc/list","1.0":"/config/pc/list_v2"},configPath="%appdata%\\kingsoft\\wps\\addons\\data\\win-i386\\kbubble_config.ini",cfgParseDecrypt=function(e){var t;return t=sdk.util.getRsaSK(),(e=sdk.util._rsaDecrypt(t,e))?(e=sdk.util.obfuscate.str2Map(e),function(t){try{return sdk.util.decodeBase64(sdk.util.obfuscate.decryptBase64(t,e))}catch(o){return sdk.noop(),""}}):(sdk.noop(),"")},configService={getConfigList:function(e){var t,o;return o=sdk.util.getNow(),t=this._getLastCleanTime()-0,o-t>cleanIniInterval&&1===window.service.getPluginLoadNumToday()&&this.clearLocalStorageData(),this._getConfigList(e)},clearLocalStorageData:function(){return this._setConfigToIni(sdk.util.encodeBase64("")),this._setLastCleanTime(),this._setLastLoadTime(0)},_ifLocalConfigExpires:function(e){var t;return t=this._getLastLoadTime()-0,sdk.util.ajax({url:"//switch.pcfg.cache.wpscdn.cn/platform_lmt/pc",type:"get",timeout:10,success:function(o){return o-=0,sdk.noop(),e(t<o)},error:function(t){return sdk.noop(),e(!0)}})},_getConfigFromService:function(e){return this._getCity(function(t){return function(o){return t._getConfigByCity(o,function(o,i){var s,n,r,a,u,c,l,d,p,f;for(o=o||[],d=[],p=t._getConfigFromIni(),f={},a=0,c=p.length;a<c;a++)n=p[a],f[n._id]=n;for(r=u=0,l=o.length;u<l;r=++u)n=o[r],s=n._id,n._last_modify_time?d.push(n):f[s]?d.push(f[s]):sdk.noop();return o=t._bubbleConfigSort(d),sdk.noop(),sdk.util.setNow(i||sdk.util.getNow()),t._setLastLoadTime(),t._setConfigToIni(sdk.util.encodeBase64(sdk.util.serialize(o))),e(o)})}}(this))},_getConfigList:function(e){var t,o;return config.enable?(o=sdk.util.getNow(),t=this._getLastLoadTime()-0,o-t<loadConfigInterval?(sdk.noop(),e(this._getConfigFromIni())):this._ifLocalConfigExpires(function(t){return function(o){return o?(sdk.noop(),t._getConfigFromService(e)):(sdk.noop(),e(t._getConfigFromIni()))}}(this))):(sdk.noop(),e([]))},_getCity:function(e){var t,o,i;return i=sdk.util.getNow(),o=sdk.tools.storage.get(keyTimeLastLoadCity),o=o?new Date(o-0):0,i-o<loadCityInterval&&(sdk.noop(),t=this._getCityFromIni())?e(t):(sdk.noop(),this._getCityFromTb(function(t){return function(o){return Math.random()<.001&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/city_online/"+!!o),o||(o=t._getCityFromIni()),sdk.tools.storage.set(keyCityBase64,sdk.util.encodeBase64(o)),sdk.system.setReg("city",sdk.util.encodeBase64(o),"HKEY_CURRENT_USER\\Software\\kingsoft\\Office\\6.0\\plugins\\kbubble"),e(o)}}(this)))},_getCityFromIni:function(){var e;return e=sdk.tools.storage.get(keyCityBase64)||"",sdk.util.decodeBase64(e)},_getCityFromSina:function(cb){return sdk.noop(),sdk.util.httpGet("http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=json",{},function(_this){return function(str){var area,city,err,error1;sdk.noop();try{area=eval("("+str+")"),city=area.city,sdk.tools.storage.set(keyCityBase64,sdk.util.encodeBase64(city)),sdk.tools.storage.set(keyTimeLastLoadCity,sdk.util.getNow()-0)}catch(error1){err=error1,city=null}return cb&&cb(city)}}(this),function(e){return function(e){return sdk.noop(),cb&&cb("")}}(this))},_getCityFromTb:function(cb){return sdk.noop(),sdk.util.httpPost("http://ip.taobao.com/service/getIpInfo2.php",{ip:"myip"},function(_this){return function(str){var area,city,err,error1;sdk.noop();try{area=eval("("+str+")"),city=area.data.city,sdk.tools.storage.set(keyCityBase64,sdk.util.encodeBase64(city)),sdk.tools.storage.set(keyTimeLastLoadCity,sdk.util.getNow()-0)}catch(error1){err=error1,city=null}return cb&&cb(city)}}(this),function(e){return function(e){return sdk.noop(),cb&&cb("")}}(this))},_getLastLoadTime:function(){return storage.get(keyTimeLastLoadConfig,appName)},_setLastLoadTime:function(e){return null==e&&(e=sdk.util.getNow()),sdk.tools.storage.set(keyTimeLastLoadConfig,e-0,appName)},_getLastModifyTime:function(){return storage.get(keyTimeLastModifyConfig,appName)},_setLastModifyTime:function(e){return null==e&&(e=sdk.util.getNow()),sdk.tools.storage.set(keyTimeLastModifyConfig,e-0,appName)},_getLastCleanTime:function(){return storage.get(keyTimeLastCleanConfig,appName)},_setLastCleanTime:function(e){return null==e&&(e=sdk.util.getNow()),sdk.tools.storage.set(keyTimeLastCleanConfig,e-0,appName)},_setConfigToIni:function(e){var t;return t=sdk.util.writeBubbleConfig(e),t instanceof Error&&"not support"===t.message?(sdk.noop(),"ruby"===sdk.platform?this._setConfigToIniForRuby(e):this._setConfigToIniForCpp(e)):t},_setConfigToIniForCpp:function(e){var t,o,i,s,n,r,a,u,c,l;for(l="!@#$",e=e.replace(/.{250}/g,function(e){return e+l}),t=e.split(l),r=t.length,u=storage.get(keyConfigListLength,appName)||0,o=s=0,c=u;0<=c?s<c:s>c;o=0<=c?++s:--s)storage.set(keyConfigList+o,"",appName);for(o=n=0,a=t.length;n<a;o=++n)i=t[o],storage.set(keyConfigList+o,i,appName);return storage.set(keyConfigListLength,r,appName)},_setConfigToIniForRuby:function(e){return storage.set(keyConfigList,e,appName)},_getConfigFromIni:function(){var err,error1,list,result;try{result=sdk.util.readBubbleConfig(),result instanceof Error&&"not support"===result.message?(sdk.noop(),list="ruby"===sdk.platform?this._getConfigFromIniForRuby():this._getConfigFromIniForCpp()):list=result,list=sdk.util.decodeBase64(list),list=""===list?[]:eval("("+list+")"),this._reportIfParseSuccess(!0,null)}catch(error1){err=error1,sdk.noop(),this._setConfigToIni(sdk.util.encodeBase64("")),this._setConfigToIni(""),list=[],this._reportIfParseSuccess(!1,err)}return list},_getConfigFromIniForCpp:function(){var e,t,o,i,s;for(i="",o=storage.get(keyConfigListLength,appName)-0||0,e=t=0,s=o;0<=s?t<s:t>s;e=0<=s?++t:--t)i+=storage.get(keyConfigList+e,appName);return i},_getConfigFromIniForRuby:function(){return storage.get(keyConfigList,appName)},_reportIfParseSuccess:function(e,t){var o,i,s,n,r,a,u,c;if(null==t&&(t=null),a="production"===sdk.env?.001:1,Math.random()>a)return!1;if(u=e?"success":"fail",t)try{r=t.message.slice(0,10)}catch(i){o=i,r="unknown_error"}else r="0";return s=window.service,n=s.getPluginLoadNumToday&&s.getPluginLoadNumToday()||1,appName=s.appName,c="http://pcfg.wps.cn:9002/report/ini_parse/"+appName+"/"+u+"/"+r+"/"+n,sdk.noop(),sdk.util.justSend(c)},_reportIfLoadSuccess:function(e,t,o){var i,s,n,r,a,u,c;if(null==o&&(o=null),r="production"===sdk.env&&"v4_2"!==t?.01:1,Math.random()>r)return!1;if(a=e?"success":"fail",o)try{n=o.message.slice(0,10)}catch(s){i=s,n="unknown_error"}else n="0";return appName=sdk.client.info.getAppName(),c=t||sdk.util.getRsaVersion()||"0",u="http://pcfg.wps.cn:9002/report/cfg_list_"+c+"/"+appName+"/"+a+"/"+n,sdk.noop(),sdk.util.justSend(u)},_getAntivirusSoftware:function(){var e;return e=sdk.as.getAsInstall("name"),e.length&&sdk.noop(),sdk.as.getAsInstall("id",",")},_getConfigByCity:function(city,cb){var config,j,k,len1,list,localModify,param,v,validLocalModify;for(list=this._getConfigFromIni()||"",localModify={},j=0,len1=list.length;j<len1;j++)config=list[j],localModify[config._id]=config._last_modify_time-0;param={_hdid:sdk.client.info.getHdid(),_city:sdk.util.aesEncrypt(city)||city,_dist:sdk.client.info.getDistNum(),_client_name:sdk.client.info.getAppName(),_client_version:sdk.client.info.getAppVersion(),_os_name:sdk.system.getOsName(),_as:this._getAntivirusSoftware(),_t:sdk.util.getNow()-0},validLocalModify=!1;for(k in localModify)v=localModify[k],v?validLocalModify=!0:delete localModify[k];return validLocalModify&&(param._last_load_time=this._getLastModifyTime()||0,param._local_modify=sdk.util.serialize(localModify)),sdk.util.ajax({url:"//switch.pcfg.cache.wpscdn.cn/ddm/pc",type:"get",timeout:10,success:function(_this){return function(ret){var domain,err,error1,info,protocol,urlLoadConfig;try{if(info=eval("("+ret+")"),domain=info.domain,protocol=info.protocol,!domain)throw new Error("地址为空");return urlLoadConfig=protocol+"//"+domain,sdk.noop(),"1.0"===sdk.util.getRsaVersion()?_this._loadConfigV4(urlLoadConfig,param,function(e,t,o){return null==o&&(o=null),_this._reportIfLoadSuccess(!!e.length,"v4",o),e.length?cb(e,t):(sdk.noop(),_this._loadConfigV4(urlLoadConfig,param,function(e,t,o){return null==o&&(o=null),_this._reportIfLoadSuccess(!!e.length,"v4_2",o),cb(e,t)}))}):_this._loadConfig(urlLoadConfig,param,function(e,t){return _this._reportIfLoadSuccess(!!e.length),cb(e,t)})}catch(error1){return err=error1,sdk.noop(),cb([],null)}}}(this),error:function(){return cb([],null)}})},_loadConfig:function(host,param,cb){var err,error1,k,key,params,path,rsa,url,v;try{rsa=sdk.util.getRsaVersion(),path=configLoadPath[rsa],key=sdk.util.getRsaSK(),params=[];for(k in param)v=param[k],"ruby"!==sdk.platform&&(v=encodeURIComponent(v)),v&&params.push(k+"="+v);return url=host+path,params.length>0&&(url+="?"+params.join("&")),sdk.util.ajax({url:url,type:"get",timeout:10,success:function(_this){return function(ret){var _data,aesKey,data,err,error1,error2,i,item,j,len1,str;sdk.noop();try{ret=eval("("+ret+")")}catch(error1){return err=error1,sdk.noop(),cb([],null)}if(data=ret.data,!rsa)return cb(data||[],ret.timestamp);if(aesKey=ret.status,aesKey=sdk.util._rsaDecrypt(key,aesKey),!aesKey)return sdk.noop(),cb([],ret.timestamp);for(_data=[],i=j=0,len1=data.length;j<len1;i=++j)if(item=data[i],"string"==typeof item){str=sdk.util.aesDecryptEx(aesKey,item);try{_data[i]=eval("("+str+")")}catch(error2){err=error2,sdk.noop()}}else _data[i]=item;return _this._setLastModifyTime(),cb(_data,ret.timestamp)}}(this),error:function(e){return sdk.noop(),cb([],null)}})}catch(error1){return err=error1,sdk.noop()}},_loadConfigV3:function(host,param,cb){var err,error1,k,key,params,path,url,v,version;try{version="v3",path="/config/pc/list_v3",key=sdk.util.getRsaSK(),params=[];for(k in param)v=param[k],"ruby"!==sdk.platform&&(v=encodeURIComponent(v)),v&&params.push(k+"="+v);return url=host+path,params.length>0&&(url+="?"+params.join("&")),sdk.util.ajax({url:url,type:"get",timeout:10,success:function(_this){return function(ret){var _data,data,err,error1,error2,i,item,j,len1,oMap,str;sdk.noop();try{ret=eval("("+ret+")")}catch(error1){return err=error1,sdk.noop(),cb([],null)}if(data=ret.data,oMap=ret.status,oMap=sdk.util._rsaDecrypt(key,oMap),!oMap)return sdk.noop(),cb([],ret.timestamp);for(oMap=sdk.util.obfuscate.str2Map(oMap),_data=[],i=j=0,len1=data.length;j<len1;i=++j)if(item=data[i],"string"==typeof item){str=sdk.util.obfuscate.decryptBase64(item,oMap),str=sdk.util.decodeBase64(str);try{_data[i]=eval("("+str+")")}catch(error2){err=error2,sdk.noop()}}else _data[i]=item;return _this._setLastModifyTime(),cb(_data,ret.timestamp)}}(this),error:function(e){return sdk.noop(),cb([],null)}})}catch(error1){return err=error1,sdk.noop()}},_loadConfigV4:function(host,param,cb){var _this,canReport,err,error1,getAllCfg,getAllId,path,probability;try{return path="/config/pc/list_v4",_this=this,probability="production"===sdk.env?.001:1,canReport=Math.random()<probability,getAllCfg=function(e){return function(t){return sdk.util.httpGet("//switch.pcfg.cache.wpscdn.cn/wps_assets/cfg/ad/switch/wps_cfg_diff",{},function(o){sdk.noop();try{if("1"===o)return e._bubbleCfgDiff(function(o,i){return null==i&&(i=[]),o?(sdk.noop(),canReport&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/cfg/req/diff/err/"+(o.message||"unknown")),e._bubbleCfgSource(function(e,o){return null==o&&(o=[]),e&&canReport&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/cfg/req/src/err/"+(e.message||"unknown")),t(o)})):t(i)})}catch(i){}return e._bubbleCfgSource(function(e,o){return null==o&&(o=[]),e&&canReport&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/cfg/req/src/err/"+(e.message||"unknown")),t(o)})},function(o){return sdk.noop(),e._bubbleCfgSource(function(e,o){return null==o&&(o=[]),e&&canReport&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/cfg/req/src/err/"+(e.message||"unknown")),t(o)})})}}(this),getAllId=function(callback){var k,params,url,v;params=[];for(k in param)v=param[k],"ruby"!==sdk.platform&&(v=encodeURIComponent(v)),v&&params.push(k+"="+v);return url=host+path,params.length>0&&(url+="?"+params.join("&")),sdk.util.ajax({url:url,type:"get",timeout:10,success:function(ret){var err,error1;sdk.noop();try{ret=eval("("+ret+")")}catch(error1){return err=error1,sdk.noop(),callback([],null)}return callback(ret.data||[],ret.timestamp)},error:function(e){return sdk.noop(),callback([],null)}})},getAllCfg(function(e){return e&&e.length?getAllId(function(t,o){var i,s,n,r,a,u,c,l,d;if(!t||!t.length)return sdk.noop(),cb([],null,new Error("no_id_list"));for(l={},n=0,a=t.length;n<a;n++)d=t[n],l[d._id]=1;for(i=[],c=0,r=0,u=e.length;r<u;r++)s=e[r],1===l[s._id]&&i.push(s),c=Math.max(c-0,s._last_modify_time||0);return _this._setLastModifyTime(c),cb(i,o)}):(sdk.noop(),cb([],null,new Error("no_cfg")))})}catch(error1){return err=error1,sdk.noop()}},_bubbleConfigSort:function(e){var t,o,i;for(e instanceof Array||(e=[]),o=0,i=e.length;o<i;o++)t=e[o],t._priority+=Math.random();return e.sort(function(e,t){return t._priority-e._priority}),e},_bubbleCfgSource:function(callback){return null==callback&&(callback=sdk.noop),sdk.util.ajax({url:"//cfg.pcfg.cache.wpscdn.cn/config/pc/list_all",type:"get",timeout:10,success:function(ret){var _decryptFunc,cfgArr,cfgStr,err,error1,error2,item,j,len1,ref,str;try{ret=eval("("+ret+")")}catch(error1){return err=error1,sdk.noop(),callback(err)}if(_decryptFunc=cfgParseDecrypt(ret.status),!_decryptFunc)return callback(new Error("rsa decrypt failed"));for(cfgArr=[],ref=ret.data,j=0,len1=ref.length;j<len1;j++)if(item=ref[j],"string"==typeof item)try{str=_decryptFunc(item),str&&cfgArr.push(eval("("+str+")"))}catch(error2){sdk.noop()}else cfgArr.push(item);return cfgStr=sdk.util.encodeBase64(JSON.stringify(cfgArr)),sdk.noop(),sdk.util.setIniByPath("config","cfg_version","",configPath),sdk.util.setIniByPath("config","cfg_base",cfgStr,configPath),callback("",cfgArr)},error:function(e){return sdk.noop(),callback(e)}})},_bubbleCfgDiff:function(callback){var canReport,cfgArr,cfgBase,cfgVer,port,probability,url;return null==callback&&(callback=sdk.noop),cfgVer=sdk.util.getIniByPath("config","cfg_version",configPath)||0,cfgBase=sdk.util.getIniByPath("config","cfg_base",configPath),cfgBase=sdk.util.decodeBase64(cfgBase),port="production"===sdk.env?"":":9080",url="http://cfg.pcfg.cache.wpscdn.cn/config/pc/list_all",probability="production"===sdk.env?.001:1,canReport=Math.random()<probability,cfgArr=[],canReport&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/cfg/req/diff"),sdk.util.ajax({url:"//df.cache.wpscdn.cn"+port+"/api/v1/diff/fetch/"+sdk.util.encodeBase64(url)+"?version="+cfgVer+"&key=c1",type:"get",timeout:10,success:function(_this){return function(ret){var _decryptFunc,cfgDiff,cfgObj,cfgStr,error1,error2,item,j,len1,ref,str;try{if(ret=eval("("+ret+")"),200!==ret.result)return callback(new Error("cfg request error"));if(sdk.util.setIniByPath("config","cfg_version",ret.data.version||0,configPath),ret.data.updated===!1&&(sdk.noop(),canReport&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/cfg/req/diff/0/"+(ret.data.code||"unknown")),cfgStr=cfgBase||"[]",cfgArr=JSON.parse(cfgStr)),ret.data.diff){if(canReport&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/cfg/req/diff/1"),cfgObj=JSON.parse(ret.data.diff),_decryptFunc=cfgParseDecrypt(cfgObj.status),!_decryptFunc)return callback(new Error("rsa decrypt failed"));if(cfgDiff=_decryptFunc(cfgObj.data),!cfgDiff)return callback(new Error("cfg parse error"));cfgStr=sdk.util.diffRecover(cfgBase,JSON.parse(cfgDiff)),cfgArr=JSON.parse(cfgStr)}if(ret.data.content){if(canReport&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/cfg/req/diff/2/"+(ret.data.code||"unknown")),cfgObj=JSON.parse(ret.data.content),_decryptFunc=cfgParseDecrypt(cfgObj.status),!_decryptFunc)return callback(new Error("rsa decrypt failed"));for(ref=cfgObj.data,j=0,len1=ref.length;j<len1;j++)if(item=ref[j],"string"==typeof item)try{str=_decryptFunc(item),str&&cfgArr.push(eval("("+str+")"))}catch(error1){sdk.noop()}else cfgArr.push(item);cfgStr=JSON.stringify(cfgArr)}return sdk.util.setIniByPath("config","cfg_base",sdk.util.encodeBase64(cfgStr),configPath),callback("",cfgArr)}catch(error2){}return callback(new Error("cfg parse error"))}}(this),error:function(e){return callback(e)}})}},window.configService=configService}.call(this),function(){var ViewAgent;ViewAgent=function(){function ViewAgent(e){this.onLoaded=null!=e?e:sdk.noop,this.classMap={normal_bubble:NormalBubbleView,normal_ex_bubble:NormalExBubbleView,material_bubble:MaterialBubbleView,shopping_bubble:ShoppingBubbleView},this.msgBoList=[],this.normalBoList=[],this.observer=new sdk["class"].Observer,this.channelBubbleClose="bubble_close",this.observer.on([this.channelBubbleClose],function(e){return function(){var t;return sdk.noop(),e.hasAliveBubble()?void sdk.noop():(t="view"===sdk.mode?config.view_exit_timeout:config.process_exit_timeout,sdk.client.plugin.exit(t,constant.PLUGIN_EXIT_CODE.NO_EXECUTABLE_BUBBLE,"没有可执行的气泡配置"))}}(this)),this.observer.on(this.channelBubbleClose,function(e){return function(t){var o,i,s,n,r;for(sdk.noop(),n=!0,r=e.getHealthyBubble(),i=0,s=r.length;i<s;i++)o=r[i],o&&o.substanceMutex&&o._id!==t&&(sdk.noop(),n=!1);return n&&sdk.bubble.kbStatusToReg("close")}}(this)),sdk.bubble.kbStatusToReg("close"),sdk.client.plugin.setWorkingStatus(!0)}return ViewAgent.prototype.start=function(){var e,t,o,i;for(i=configService._getConfigFromIni(),sdk.noop(),this.boMap={},t=0,o=i.length;t<o;t++)e=i[t],this.boMap[e._id]=e;return window.config.overlayKilled&&sdk.tools.observer.on("overlayGroupInfo",function(e){return function(t,o){var i,s,n,r,a,u,c;sdk.noop();try{for(u=e.normalBoList,c=[],r=0,a=u.length;r<a;r++)i=u[r],i.alive&&(i._id!==t&&i.overlayGroup===o&&(i.view&&i.view.valid()||i.executing)?(sdk.noop(),c.push(i.close(window.constant.TYPE_CLOSE_BY_OVERLAY_GROUP))):c.push(void 0));return c}catch(n){return s=n,sdk.noop()}}}(this)),sdk.tools.observer.on("killOthers",function(e){return function(t){var o,i,s,n,r,a,u;sdk.noop();try{for(a=e.normalBoList,u=[],n=0,r=a.length;n<r;n++)o=a[n],o.alive&&(o._id!==t&&(o.view&&o.view.valid()||o.executing)?(sdk.noop(),u.push(o.close(window.constant.TYPE_CLOSE_BY_OVERLAY_GROUP))):u.push(void 0));return u}catch(s){return i=s,sdk.noop()}}}(this)),this.onLoaded&&this.onLoaded()},ViewAgent.prototype.clearBoList=function(){return this.msgBoList=[],this.normalBoList=[]},ViewAgent.prototype.hasAliveBubble=function(){var e,t,o,i,s,n;this.msgBoList=this.msgBoList||[],this.normalBoList=this.normalBoList||[];try{for(t=this.normalBoList.concat(this.msgBoList),sdk.noop(),s=0,n=t.length;s<n;s++)if(e=t[s],e.alive){if(sdk.noop(),e.executing)return sdk.noop(),!0;if(!e.view||e.view.valid()){if(!e.view||e.view.isHealthy())return!0;sdk.noop(),e.close(constant.TYPE_CLOSE_BY_RELOAD)}else sdk.noop()}}catch(i){o=i,sdk.noop()}return!1},ViewAgent.prototype.getAliveBubble=function(){var e,t,o,i,s,n,r;this.msgBoList=this.msgBoList||[],this.normalBoList=this.normalBoList||[],e=[];try{for(o=this.normalBoList.concat(this.msgBoList),sdk.noop(),n=0,r=o.length;n<r;n++)t=o[n],t.isAlive()&&(sdk.noop(),e.push(t))}catch(s){i=s,sdk.noop()}return e},ViewAgent.prototype.getHealthyBubble=function(){var e,t,o,i,s,n,r;this.normalBoList=this.normalBoList||[],e=[];try{for(o=this.normalBoList,sdk.noop(),n=0,r=o.length;n<r;n++)t=o[n],t.alive&&(sdk.noop(),(!t.view||t.view.valid())&&(!t.view||t.view.isHealthy())?e.push(t):sdk.noop())}catch(s){i=s,sdk.noop()}return e},ViewAgent.prototype.isDisabledPageReload=function(){var e,t,o,i,s,n,r;this.msgBoList=this.msgBoList||[],this.normalBoList=this.normalBoList||[],o=!1;try{for(t=this.normalBoList.concat(this.msgBoList),sdk.noop(),n=0,r=t.length;n<r;n++)if(e=t[n],e.isAlive()&&e.disabledPageReload){o=!0;break}}catch(s){i=s,sdk.noop()}return o},ViewAgent.prototype.popNormalBubble=function(e){var t,o,i,s,n,r,a,u,c,l;if(a=e.replace("wps_exec_view/",""),l=a.split("_")[0],i=a.split("_")[1],s=this.boMap[i],n=!1,!s)return sdk.noop(),this.observer.fire(this.channelBubbleClose,i),this.sendExecViewResult(a,0);for(c=this.normalBoList,r=0,u=c.length;r<u;r++){if(t=c[r],t._id===i&&t.isAlive())return sdk.noop(),this.observer.fire(this.channelBubbleClose,i),this.sendExecViewResult(a,0);t.hasHighValue&&t._id!==i&&t.isAlive()&&s.overlay_group===t.overlayGroup&&(sdk.noop(),sdk.noop(),n=!0)}return o=new this.classMap[s._template_type](s),n?(o._sendPopupFailInfo(9051),this.observer.fire(this.channelBubbleClose,i),this.sendExecViewResult(a,0)):(o.observer.on("destroy",function(e){return function(t){return e.observer.fire(e.channelBubbleClose,t),e.sendViewDestroy(a)}}(this)),o.tryExec(function(e){return function(t){var o;return o=t?"1":"0",e.sendExecViewResult(a,o)}}(this)),this.normalBoList.push(o))},ViewAgent.prototype.sendExecViewResult=function(e,t){var o;return o="wps_view_result/"+e+"#"+t,this.sendViewMsg(o)},ViewAgent.prototype.sendViewDestroy=function(e){var t;return t="wps_view_destroy/"+e,this.sendViewMsg(t)},ViewAgent.prototype.sendViewMsg=function(e){return"view"===sdk.mode?this.notifyBubbleMsg("msg="+e):window.service.agent.receiveMessage(e)},ViewAgent.prototype.receiveMessage=function(e,t){return sdk.noop(),/^wps_cmd/.test(e)?this.processCommand(e):/^windows_/.test(e)?this.processWindowMsg(e):/^wps_msg_push/.test(e)?this.popMsgBubble(e):/^wps_exec_view/.test(e)?this.popNormalBubble(e):/^wps_svr_fire/.test(e)?this.processFire(e):void sdk.noop()},ViewAgent.prototype.stop=function(e,t){return null==t&&(t=""),sdk.noop(),sdk.tools.observer.fire("window_close",-1,constant.TYPE_CLOSE_BY_MIDNIGHT_RELOAD),sdk.client.plugin.exit(2e4,e,t),sdk.util.justSend("http://pcfg.wps.cn:9002/report/overnight_reload"),sdk.noop()},ViewAgent.prototype.processCommand=function(e){var t,o,i,s,n,r,a,u,c,l;sdk.noop();try{s=sdk.util.serialize(e.replace("wps_cmd/base64:","")),c=sdk.util.decodeBase64(s),o=sdk.util.decodeBase64(c)}catch(r){return n=r,void sdk.noop()}for(i=o.split("&"),a=0,u=i.length;a<u;a++){if(t=i[a],"clean"===t&&(sdk.noop(),configService.clearLocalStorageData(),sdk.noop()),"stop"===t)return sdk.noop(),this.stop(constant.PLUGIN_EXIT_CODE.STOP,"关闭服务");/^stop_\d+$/.test(t)&&(l=t.replace("stop_","")-0,sdk.noop(),sdk.tools.observer.fire("window_close",l,constant.TYPE_CLOSE_BY_CMD))}return sdk.noop()},ViewAgent.prototype.processWindowMsg=function(e){var t,o,i,s,n,r,a;try{if("windows_msg_displaychange"===e){for(r=this.getAliveBubble(),a=[],s=0,n=r.length;s<n;s++)t=r[s],t.view&&a.push(t.view.moveToRightBottom());return a}}catch(i){return o=i,sdk.noop()}},ViewAgent.prototype.popMsgBubble=function(msg){var body,d64,err,error,json,mb,server,url;this.msgBubbleMap=this.msgBubbleMap||{},this.msgBoList=this.msgBoList||[];try{if(d64=sdk.util.serialize(msg.replace("wps_msg_push/base64:","")),json=eval("("+sdk.util.decodeBase64(d64)+")"),url=json.url,body=json.message,server=json.server,sdk.noop(),this.msgBubbleMap[url]?mb=this.msgBubbleMap[url]:(mb=new MsgBubbleView(url),mb.observer.on("destroy",function(e){return function(){return e.observer.fire(e.channelBubbleClose),delete e.msgBubbleMap[url]}}(this)),mb.exec(),this.msgBubbleMap[url]=mb,this.msgBoList.push(mb)),mb.isValid())return mb.sendMessage(server,body)}catch(error){return err=error,sdk.noop()}},ViewAgent.prototype.processFire=function(e){var t,o;return o=e.replace("wps_svr_fire/base64:",""),o=sdk.util.decodeBase64(o),t=sdk.util.deserialize(o),sdk.tools.observer.fire.apply(sdk.tools.observer,[t.name].concat(t.args))},ViewAgent.prototype.notifyBubbleMsg=function(e){return window.Service?service.agent.receiveMessage(e):sdk.client.plugin.notifyBubbleMsg(e)},ViewAgent}(),window.ViewAgent=ViewAgent}.call(this),function(){var Agent,BUBBLE_ACTIVE,BUBBLE_START;BUBBLE_START=5e3,BUBBLE_ACTIVE=18e5,Agent=function(){function Agent(e){this.onLoaded=null!=e?e:sdk.noop,this.classMap={normal_bubble:NormalBubble,normal_ex_bubble:NormalExBubble,custom_bubble:CustomBubble,material_bubble:MaterialBubble,shopping_bubble:ShoppingBubble},this.observer=new sdk["class"].Observer,this.channelConfigListDownload="bubble_download",window.viewAgent&&this.observer.on([this.channelConfigListDownload],function(e){return function(){return sdk.noop(),window.viewAgent.hasAliveBubble()?void sdk.noop():sdk.client.plugin.exit(config.process_exit_timeout,constant.PLUGIN_EXIT_CODE.NO_EXECUTABLE_BUBBLE,"没有可执行的气泡配置")}}(this))}return Agent.prototype.start=function(){return this.pushNotifyToDb(),configService.getConfigList(function(e){return function(t){var o,i,s,n,r;for(null==t&&(t=[]),sdk.noop(),sdk.client.user.setLastLoginUserId(),Math.random()<=.01&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/cfg_finally/"+sdk.client.info.getAppName()+"/"+(0!==t.length)+"/0"),e.registerProcessMonitor(t),e.boMap={},e.customBoMap={"":[]},e.normalBoMap={"":[]},i=function(t,o){var i,s,n,r,a,u,c,l,d;try{if(i=new e.classMap[t._template_type](t),e.boMap[i._id]=i,i instanceof CustomBubble?(sdk.noop(),u=e.customBoMap):(sdk.noop(),u=e.normalBoMap),i.notifyGroup.length){for(l=i.notifyGroup,d=[],r=0,a=l.length;r<a;r++)c=l[r],u[c]||(u[c]=[]),d.push(u[c].push(i));return d}return u[""].push(i)}catch(n){return s=n,sdk.noop()}},n=s=0,r=t.length;s<r;n=++s)o=t[n],i(o,n);return e.observer.fire(e.channelConfigListDownload),setTimeout(function(){if(t.length)return e.startBubbleInterval("bubble_start"),sdk.client.trayicon.init(!1,function(){return e.trayIconMessage("tray_icon_3/base64:"+sdk.util.encodeBase64("tray_icon_init"),new Date-0)})},BUBBLE_START),setTimeout(function(){if(t.length)return e.startBubbleInterval("bubble_start_5min")},3e5),setTimeout(function(){if(t.length)return e.startBubbleInterval("bubble_active")},BUBBLE_ACTIVE),sdk.noop(),e.informationPoll=new sdk["class"].InformationPoll,e.informationPoll.init(function(){var t;return sdk.noop(),e.informationPoll.clearInfo(),t=sdk.util.encodeBase64("empty"),e.receiveMessage("intelligent_scene/base64:"+t,sdk.util.getNow())}),sdk.noop(),e.initBrowserUrlInterval(),sdk.service.info.loaded(),e.onLoaded&&e.onLoaded()}}(this))},Agent.prototype.clearBoList=function(){return this.boMap={},this.customBoMap={"":[]},this.normalBoMap={"":[]}},Agent.prototype.startBubbleInterval=function(e){if(!this.test)return sdk.noop(),this.execCustomBubble(0,(this.customBoMap[e]||[]).concat(this.customBoMap[""]),e),this.tryExecNormalBubble(0,(this.normalBoMap[e]||[]).concat(this.normalBoMap[""]),e)},Agent.prototype.initBrowserUrlInterval=function(){return this.browserUrl={},this.browserText={},this.browserInfo={},setInterval(function(e){return function(){var t,o;sdk.noop();try{return e.browserUrl.text&&(sdk.noop(),e.execNotifyBubble("browsetheweb_url_urls",sdk.util.serialize(e.browserUrl),Math.floor((new Date-0)/1e3))),e.browserText.text&&(sdk.noop(),e.execNotifyBubble("browsetheweb_url_texts",sdk.util.serialize(e.browserText),Math.floor((new Date-0)/1e3))),e.browserInfo.text&&(sdk.noop(),e.execNotifyBubble("browsetheweb_url_info",sdk.util.serialize(e.browserInfo),Math.floor((new Date-0)/1e3))),e.browserUrl={},e.browserText={},e.browserInfo={}}catch(o){return t=o,sdk.noop()}}}(this),3e4)},Agent.prototype.addBrowserUrl=function(info){var _info,err,error;try{return _info=eval("("+info+")").browserinfo[0],_info.url&&(_info.name&&(this.browserUrl.name=_info.name),_info.pid&&(this.browserUrl.pid=_info.pid),this.browserUrl.text?this.browserUrl.text+=";"+_info.url:this.browserUrl.text=_info.url),_info.text&&(_info.name&&(this.browserText.name=_info.name),_info.pid&&(this.browserText.pid=_info.pid),this.browserText.text?this.browserText.text+=";"+sdk.bubble.rmBrowserName(_info.text):this.browserText.text=sdk.bubble.rmBrowserName(_info.text)),_info&&(_info.name&&(this.browserInfo.name=_info.name),_info.pid&&(this.browserInfo.pid=_info.pid),this.browserInfo.text=sdk.bubble.rmBrowserName(_info.text),this.browserInfo.url=_info.url),sdk.noop()}catch(error){return err=error,sdk.noop()}},Agent.prototype.execCustomBubble=function(e,t,o,i){var s;return t.length<=e?void sdk.noop():(s=t[e],sdk.noop(),s?s.canPopup(o,i,function(n){return function(r){return r&&s.exec(),n.execCustomBubble(e+1,t,o,i)}}(this)):this.execCustomBubble(e+1,t,o,i))},Agent.prototype.tryExecNormalBubble=function(e,t,o,i,s){var n,r,a,u,c;if(t.length<=e)return sdk.noop(),void sdk.service.info.sendMsgTrace("js_finish_without_popup",s,o,i);if(n=t[e],sdk.noop(),!n)return this.tryExecNormalBubble(e+1,t,o,i,s);try{return c=function(r){return function(){var a,u;return o&&(u=.01,1===Math.ceil(Math.random()/u)&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/msg/"+o+"/"+u+"/1"),n._backupGlobalLastExecDate()),a=s+"_"+n._id,n.tryExec(a,function(n){return n?(sdk.noop(),void sdk.service.info.sendMsgTrace("js_finish_with_popup",s,o,i)):(sdk.noop(),r.tryExecNormalBubble(e+1,t,o,i,s))})}}(this),u=function(n){return function(){return sdk.noop(),n.tryExecNormalBubble(e+1,t,o,i,s)}}(this),n.canPopup(o,i,function(e){return function(e){return sdk.noop(),"tray_icon_3"===o&&(sdk.util.justSend("http://pcfg.wps.cn:9002/report/trace/recommend_popup/"+i+"/canPopup/"+e),sdk.util.justSend("http://log.u.wps.cn/v0/api/visit/trace/recommend_popup/"+i+"/canPopup/"+e)),e?c():u()}}(this))}catch(a){return r=a,sdk.noop()}},Agent.prototype.receiveViewMsg=function(e){var t,o;return/^wps_view_result/.test(e)?(e=e.replace("wps_view_result/",""),t=e.split("#")[0],o=e.split("#")[1],"1"===o?sdk.tools.observer.fire(t+"_show"):sdk.tools.observer.fire(t+"_stop")):/^wps_view_destroy/.test(e)?(t=e.replace("wps_view_destroy/",""),sdk.tools.observer.fire(t+"_destroy")):void 0},Agent.prototype.receiveMessage=function(e,t){return/^wps_cmd/.test(e)?this.processCommand(e):/^windows_/.test(e)?this.processWindowMsg(e):/^test_/.test(e)?this.popTestBubble(e):/^wps_msg_push/.test(e)?this.launchWpsInfoExe(e):/^wps_env/.test(e)?this.recordEnv(e):"tray_icon_init"===e?(sdk.util.justSend("http://pcfg.wps.cn:9002/report/trace/recommend_popup/tray_icon_init/channel"),sdk.util.justSend("http://log.u.wps.cn/v0/api/visit/trace/recommend_popup/tray_icon_init/channel"),this.trayIconCallUp(e)):"tray_icon_shortcut"===e?(sdk.util.justSend("http://pcfg.wps.cn:9002/report/trace/recommend_popup/tray_icon_shortcut/channel"),sdk.util.justSend("http://log.u.wps.cn/v0/api/visit/trace/recommend_popup/tray_icon_shortcut/channel"),sdk.service.info.trayicon("shortcut","click"),
this.trayIconCallUp(e)):/^wps_view_fire/.test(e)?this.processFire(e):/^wps_view/.test(e)?this.receiveViewMsg(e):this.popNotifyBubble(e,t)},Agent.prototype.trayIconMessage=function(e,t){var o;return"tray_menu_silence"===e?(sdk.client.trayicon.setSilence(),sdk.shopping.setUserData(),sdk.tools.observer.fire("window_close",-1,constant.TYPE_CLOSE_BY_MENU_SILENCE)):"tray_menu_realtime"===e?(sdk.client.trayicon.setSilence(!1),sdk.shopping.setUserData()):"tray_menu_feedback"===e?(o="https://h5.mini.wps.cn/wps/erelease/#/feedBack/#hdid="+sdk.client.info.getHdid()+"&version="+sdk.client.info.getAppVersion()+"&distsrc="+sdk.client.info.getDistNum()+"&source=0",sdk.bubble.hasMiniBox()&&sdk.system.openUrlWithMiniBox(o)):this.popNotifyBubble(e,t)},Agent.prototype.trayIconCallUp=function(e){return sdk.client.trayicon.isSubscribe()||sdk.client.trayicon.setSubscribe(!0),"bind"!==sdk.mode?(sdk.noop(),sdk.client.trayicon.setBindMode(!0),sdk.client.plugin.restartKBubble()):sdk.client.trayicon.isInit()?(sdk.client.trayicon.init(!0),this.trayIconMessage("tray_icon_3/base64:"+sdk.util.encodeBase64(e),new Date-0)):sdk.client.trayicon.init(!0,function(t){return function(){return t.trayIconMessage("tray_icon_3/base64:"+sdk.util.encodeBase64(e),new Date-0)}}(this))},Agent.prototype.processFire=function(e){var t,o;return o=e.replace("wps_view_fire/base64:",""),o=sdk.util.decodeBase64(o),t=sdk.util.deserialize(o),sdk.tools.observer.fire.apply(sdk.tools.observer,[t.name].concat(t.args))},Agent.prototype.stop=function(e,t){return null==t&&(t=""),sdk.noop(),sdk.tools.observer.fire("window_close",-1,constant.TYPE_CLOSE_BY_MIDNIGHT_RELOAD),sdk.client.plugin.exit(2e4,e,t),sdk.util.justSend("http://pcfg.wps.cn:9002/report/overnight_reload"),sdk.noop()},Agent.prototype.restart=function(){return sdk.noop(),this.stop(constant.PLUGIN_EXIT_CODE.RESTART_FAILED,"重启服务"),sdk.noop(),sdk.client.plugin.reload(constant.PLUGIN_EXIT_CODE.RESTART),setTimeout(function(e){return function(){return sdk.noop(),window.location.reload(!1)}}(this),3e4),sdk.noop()},Agent.prototype.processCommand=function(e){var t,o,i,s,n,r,a,u,c,l;sdk.noop();try{s=sdk.util.serialize(e.replace("wps_cmd/base64:","")),c=sdk.util.decodeBase64(s),o=sdk.util.decodeBase64(c)}catch(r){return n=r,void sdk.noop()}for(i=o.split("&"),a=0,u=i.length;a<u;a++){if(t=i[a],"clean"===t&&(sdk.noop(),configService.clearLocalStorageData(),sdk.noop()),"stop"===t)return sdk.noop(),this.stop(constant.PLUGIN_EXIT_CODE.STOP,"关闭服务");if("restart"===t)return sdk.noop(),this.restart();/^stop_\d+$/.test(t)&&(l=t.replace("stop_","")-0,sdk.noop(),sdk.tools.observer.fire("window_close",l,constant.TYPE_CLOSE_BY_CMD))}return sdk.noop()},Agent.prototype.popNotifyBubble=function(msg,startTime){var browserInfo,err,error,info,match,wps_process;sdk.service.info.sendMsgTrace("js_start_handle_popup",startTime,msg);try{match=msg.match(/^([^\/]+)\/base64:(\S+)$/),match&&match[1]&&match[2]&&(msg=match[1],info=sdk.util.decodeBase64(match[2]),info=info.toLowerCase(),sdk.noop())}catch(error){err=error,sdk.noop()}return"tray_icon_3"===msg&&(sdk.util.justSend("http://pcfg.wps.cn:9002/report/trace/recommend_popup/"+info+"/transiton"),sdk.util.justSend("http://log.u.wps.cn/v0/api/visit/trace/recommend_popup/"+info+"/transiton")),"process_start"===msg&&info&&(wps_process=eval("("+info+")")||{},["wps.exe","wpp.exe","et.exe"].indexOf(wps_process.processname||"")>-1)?void sdk.noop():(sdk.util.cache.set("currentMsgInfo",info),"browsetheweb_common"===msg?(browserInfo=sdk.bubble.parseBrowserInfo(info),browserInfo.top_url&&this.execNotifyBubble("browsetheweb_common_top_url",browserInfo.top_url,startTime),browserInfo.top_main&&this.execNotifyBubble("browsetheweb_common_top_main",browserInfo.top_main,startTime),browserInfo.multi_url&&this.execNotifyBubble("browsetheweb_common_multi_url",browserInfo.multi_url,startTime),browserInfo.top_all&&this.execNotifyBubble("browsetheweb_common_top_all",browserInfo.top_all,startTime),browserInfo.multi_main&&this.execNotifyBubble("browsetheweb_common_multi_main",browserInfo.multi_main,startTime),void(browserInfo.multi_all&&this.execNotifyBubble("browsetheweb_common_multi_all",browserInfo.multi_all,startTime))):"browsetheweb_url"===msg?(this.execTrayAdUrlBubble("tray_ad_url",info,startTime),void this.addBrowserUrl(info)):this.execNotifyBubble(msg,info,startTime))},Agent.prototype.execNotifyBubble=function(msg,info,startTime){var _info,browserName;if(("browsetheweb"===msg||"browsetheweb_common_top_main"===msg||"browsetheweb_url_texts"===msg)&&info)try{_info=eval("("+info+")"),browserName=_info.name||_info["browserName".toLowerCase()],browserName&&sdk.browser.setLastTop(browserName,_info.pid||"")}catch(undefined){}return this.customBoMap=this.customBoMap||{},this.normalBoMap=this.normalBoMap||{},this.customBoMap[msg]=this.customBoMap[msg]||[],this.normalBoMap[msg]=this.normalBoMap[msg]||[],sdk.service.info.sendMsgTrace("js_start_popup_custom_bubble",startTime,msg,info),this.execCustomBubble(0,this.customBoMap[msg].concat(this.customBoMap[""]),msg,info),sdk.service.info.sendMsgTrace("js_start_popup_normal_bubble",startTime,msg,info),this.tryExecNormalBubble(0,this.normalBoMap[msg].concat(this.normalBoMap[""]),msg,info,startTime)},Agent.prototype.execTrayAdUrlBubble=function(msg,info,startTime){var _info,browserName,error;if(!sdk.client.trayicon.isSubscribe())return sdk.noop(),!1;try{_info=eval("("+info+")"),_info=_info.browserinfo[0],(browserName=_info.name)&&sdk.browser.setLastTop(browserName,_info.pid||"")}catch(error){}return this.customBoMap=this.customBoMap||{},this.normalBoMap=this.normalBoMap||{},this.customBoMap[msg]=this.customBoMap[msg]||[],this.normalBoMap[msg]=this.normalBoMap[msg]||[],sdk.service.info.sendMsgTrace("js_start_popup_custom_bubble",startTime,msg,info),this.execCustomBubble(0,this.customBoMap[msg],msg,info),sdk.service.info.sendMsgTrace("js_start_popup_normal_bubble",startTime,msg,info),this.tryExecNormalBubble(0,this.normalBoMap[msg],msg,info,startTime)},Agent.prototype.processWindowMsg=function(e){if("windows_msg_displaychange"===e&&window.viewAgent)return viewAgent.receiveMessage(e)},Agent.prototype.recordEnv=function(e){var t,o,i,s,n,r,a;try{sdk.noop(),n=sdk.util.collectEnv(),sdk.noop(),i="myEnv",sdk.util.removeIniGroup(i),r=[];for(s in n)a=n[s],r.push(sdk.util.setIni(i,s,a));return r}catch(o){return t=o,sdk.noop()}},Agent.prototype.popTestBubble=function(e){var t,o,i,s,n,r;sdk.noop(),this.test=!0;try{if("test_close_bubble"===e)return void(this.bubble&&this.bubble.view.destroy());if(/test_popupbyname_/.test(e)){r=e.replace("test_popupbyname_","");for(o in this.boMap)o.config._name===r&&o.isValid("","")&&(o.tryExec(),this.bubble=o)}if(/test_popupbyid_/.test(e)&&(n=/test_popupbyid_1_/.test(e),t=e.replace(/test_popupbyid_(\d_)?/,""),o=this.boMap[t],o&&(n||o.isValid("",""))))return o.tryExec(),this.bubble=o}catch(s){return i=s,sdk.noop()}},Agent.prototype.pushNotifyToDb=function(){var e,t,o;if(t="notifyName",o=sdk.util.parseDateTo0amStamp(),e=sdk.util.parseDateTo0amStamp(sdk.util.getIni(t,"date")-0),o!==e)return sdk.util.removeIniGroup(t),sdk.util.setIni(t,"date",o)},Agent.prototype.notifyNameLog=function(e){var t,o,i;return sdk.noop(),t="notifyName",i=sdk.util.getIni(t,e+"_num")-0,sdk.util.setIni(t,e+"_num",i+1),o=sdk.util.getIni(t,"names").split(";"),sdk.util.indexOf(e,o)<0&&o.push(e),sdk.util.setIni(t,"names",o.join(";"))},Agent.prototype.registerProcessMonitor=function(e){var t,o,i,s,n,r,a,u,c;if("ruby"===sdk.platform){for(u={},o=0,s=e.length;o<s;o++)if(t=e[o],"process_start"===t._group_name)for(c=t._group_info.split(";"),i=0,n=c.length;i<n;i++)a=c[i],u[a]||(u[a]=1);r=[];for(a in u)r.push(a);return sdk.client.plugin.registerProcessMonitorList(r)}},Agent.prototype.updateHistory2Ck=function(){return sdk.noop(),sdk.util.ckRec.updateAllHistory(),setInterval(function(){return sdk.util.ckRec.updateAllHistory()},config.update_history_interval)},Agent.prototype.launchWpsInfoExe=function(e){return window.viewAgent?viewAgent.receiveMessage(e):sdk.client.plugin.launchWpsInfoExe("msg="+e)},Agent}(),window.Agent=Agent}.call(this),function(){var Service;Service=function(){function Service(){sdk.client.plugin.serviceReady(),this.appName=sdk.client.info.getAppName(),this.today=sdk.util.formatDate(sdk.util.getNow(),"yyyy_MM_dd"),this.keyReloadNumToday="reload_num_"+this.appName+"_"+this.today,this.keyPluginLoadNumToday="plugin_load_num_"+this.appName+"_"+this.today,this.keyPluginLastLoadTime="plugin_last_load_time_"+this.appName,window.ViewAgent&&(window.viewAgent=new window.ViewAgent),this.agent=new Agent(function(){if(sdk.client.plugin.serviceLoaded(),window.viewAgent)return viewAgent.start()}),this.setPluginLastLoadTime(sdk.util.getNow()),0===Math.floor(1e3*Math.random())&&sdk.util.justSend("http://120.92.93.69:82/report/"+this.appName+"/load/"+this.getPluginLoadNumToday())}return Service.prototype.begin=function(){var e;return this.isValidDist()?(this.inValidEnv()?(this.incrPluginLoadNumToday(),this.report(),sdk.noop(),"c++"===sdk.platform&&sdk.client.plugin.enableSceneMsgPush(1),this.agent.start()):(this.incrPluginReloadNumToday(),e=this.getPluginReloadNumToday(),config.maxReloadNumADay>=e?(sdk.noop(),setTimeout(function(){return sdk.client.plugin.upgrade()},6e4)):(sdk.util.justSend("http://pcfg.wps.cn:9002/report/reboot_more_then_3_times"),sdk.noop(),sdk.client.plugin.exit(1e4,constant.PLUGIN_EXIT_CODE.INVALID_ENV,"环境异常"))),sdk.noop(),this.pageReloadInterval=setInterval(function(e){return function(){var t,o;if(sdk.noop(),t=e.getPluginLastLoadTime().getDate(),o=sdk.util.getNow().getDate(),t!==o){if(window.viewAgent){if(window.viewAgent.isDisabledPageReload())return;sdk.tools.observer.fire("window_close",-1,constant.TYPE_CLOSE_BY_MIDNIGHT_RELOAD)}return sdk.client.plugin.exit(1e4,constant.PLUGIN_EXIT_CODE.ANOTHER_DAY,"进入另一天自动退出"),sdk.util.justSend("http://pcfg.wps.cn:9002/report/overnight_reload")}}}(this),config.page_reload_time_interval),sdk.noop(),this.ServiceReloadInterval=setInterval(function(e){return function(){return sdk.noop(),window.viewAgent&&window.viewAgent.hasAliveBubble()?void sdk.noop():e.reload()}}(this),config.service_reload_time_interval)):sdk.client.plugin.exit(1e4,constant.PLUGIN_EXIT_CODE.CHANNEL_SCREENED,"渠道屏蔽")},Service.prototype.start=function(){var e,t;sdk.service.info.start(),sdk.noop();try{sdk.bubble.setMaterialTagsToIni(function(e){if(e)return sdk.bubble.refreshMaterialPicker()})}catch(t){e=t,sdk.noop()}return this.setSwitchConfig(function(e){return function(){return"ruby"!==sdk.platform||"bind"!==sdk.mode?e.begin():e.getBubble2Config(function(t,o,i){return null==o&&(o="wps.exe"),null==i&&(i=!1),t&&!sdk.client.plugin.isRunInWps()?sdk.client.plugin.runBubbleWithOtherExe(o,i,function(){return sdk.noop(),sdk.client.plugin.exit(1e4,constant.PLUGIN_EXIT_CODE.RUN_WITH_OTHER_EXE,"已成功调起runBubbleWithOtherExe，准备退出"),function(){var t,i;return t="run_"+o+"_succeed_"+e.today,i=sdk.tools.storage.get(t)-0,1!==i&&(sdk.tools.storage.set(t,1),sdk.util.justSend("http://pcfg.wps.cn:9002/report/runothersucceed/"+o))}()},function(t){return t?(sdk.noop(),e.begin()):(sdk.noop(),sdk.client.plugin.runBubble2(function(){return sdk.noop(),sdk.client.plugin.exit(1e4,constant.PLUGIN_EXIT_CODE.RUN_WITH_KBUBBLE2,"已成功调起kbubble2，准备退出"),function(){var t,o;return t="run_bubble2_succeed_"+e.today,o=sdk.tools.storage.get(t)-0,1!==o&&(sdk.tools.storage.set(t,1),sdk.util.justSend("http://pcfg.wps.cn:9002/report/runkb2succeed"))}()},function(){return sdk.noop(),e.begin()}))}):(sdk.noop(),e.begin())})}}(this))},Service.prototype.stop=function(){if(this.agent.clearBoList(),sdk.util.iniCache.clear(),this.pageReloadInterval&&clearInterval(this.pageReloadInterval),this.ServiceReloadInterval)return clearInterval(this.ServiceReloadInterval)},Service.prototype.restart=function(){return this.stop(),this.start()},Service.prototype.reload=function(){return this.stop(),sdk.noop(),sdk.client.plugin.reload(constant.PLUGIN_EXIT_CODE.CONFIG_UPDATE_INTERVAL),setTimeout(function(e){return function(){return sdk.noop(),window.location.reload(!1)}}(this),3e4)},Service.prototype.inValidEnv=function(){var e;return e=sdk.client.info.getAppVersion()||"",!function(t){return function(){var o,i;return i=new Date-0,o="evn_check_timestamp",sdk.util.setIni(t.appName,o,i),sdk.util.getIni(t.appName,o)!==i+""&&(sdk.util.justSend("http://pcfg.wps.cn:9002/report/appName_"+t.appName+"/clientVersion_"+e+"/set_ini_failed"),sdk.noop(),!0)}}(this)()},Service.prototype.isValidDist=function(){return!function(e){return function(){return!("pptassist"!==e.appName||!/^80\.267/.test(sdk.client.info.getDistNum()))}}(this)()&&(!function(e){return function(){return!("te"!==e.appName||!/^40\.539|40\.115/.test(sdk.client.info.getDistNum()))}}(this)()&&!function(e){return function(){return!("powerword"!==e.appName||!/^800\.3059|800\.3061|800\.3154|800\.3155|800\.159/.test(sdk.client.info.getDistNum()))}}(this)())},Service.prototype.report=function(){var e,t,o;if("1.0.5.58"===sdk.client.info.getPlgVersion()&&0===Math.floor(10*Math.random())&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/load58_2/"+(1===this.getPluginLoadNumToday())),0===Math.floor(1e3*Math.random())&&sdk.util.justSend("http://pcfg.wps.cn:9002/report/"+this.appName+"/load/"+this.getPluginLoadNumToday()),e="production"===sdk.env?.001:1,0===Math.floor(Math.random()/e)&&1===this.getPluginLoadNumToday())return o=/^\/wps_assets/.test(window.location.pathname)?"wps_assets":"old_version",t=window.location.protocol,sdk.util.justSend("http://pcfg.wps.cn:9002/report/"+this.appName+"/"+t+"/"+o+"/"+e)},Service.prototype.popBubbleByNotifyGroup=function(e,t){if(sdk.service.info.sendMsgTrace("js_service_receive",t,e||""),"upgrade_bubble"!==e&&"upgrade_wps"!==e||(e="wps_upgrade"),sdk.noop(),e||this.inValidEnv())try{return this.agent.receiveMessage(e,t),1}catch(o){return-1}},Service.prototype.trayIconNotifyChannel=function(groupName,startTime){var error,evtObj,groupInfo,silenceName;if(null==startTime&&(startTime=sdk.util.getNow()),sdk.service.info.sendMsgTrace("js_service_receive",startTime,groupName||""),sdk.noop(),groupName||this.inValidEnv())try{if(evtObj=eval("("+groupName+")"),"TrayIconActive"===evtObj.method){if(groupName="tray_icon_"+evtObj.activeReason,"tray_icon_1"===groupName||"tray_icon_4"===groupName)return sdk.service.info.trayicon("tray",groupName),-1}else{if("MenuClick"!==evtObj.method)return-1;silenceName="Silence",evtObj.action===silenceName?groupName=evtObj.checked?"tray_menu_silence":"tray_menu_realtime":("agree"===evtObj.action&&(evtObj.info=evtObj.info||1),groupInfo=evtObj.info?"/base64:"+sdk.util.encodeBase64(evtObj.info):"",groupName="tray_menu_"+evtObj.action.toLowerCase()+groupInfo)}return sdk.service.info.trayicon("tray",groupName),"tray_icon_3"===groupName&&(sdk.util.justSend("http://pcfg.wps.cn:9002/report/trace/recommend_popup/tray_icon_click/channel"),sdk.util.justSend("http://log.u.wps.cn/v0/api/visit/trace/recommend_popup/tray_icon_click/channel"),groupName="tray_icon_3/base64:dHJheV9pY29uX2NsaWNr"),this.agent.trayIconMessage(groupName,startTime),1}catch(error){return-1}},Service.prototype.setSwitchConfig=function(e){return sdk.noop(),sdk.util.httpGet("//switch.pcfg.cache.wpscdn.cn/wps_assets/cfg/ad/switch/bubble",{},function(t){return function(t){var o,i,s,n,r,a,u,c,l,d;sdk.noop();try{if(/-1\s*/.test(t))window.config.enable=!1;else{for(l={},i=t.split("\n"),r=0,c=i.length;r<c;r++)o=i[r],a=o.indexOf("="),u=o.substr(0,a),d=o.substr(a+1),isNaN(d-0)||(d-=0),window.config[u]=d;window.config.enable=!0}}catch(n){s=n,sdk.noop()}return e&&e()}}(this),function(t){return function(t){return sdk.noop(),e&&e()}}(this))},Service.prototype.getBubble2Config=function(e){return sdk.noop(),sdk.util.httpGet("//switch.pcfg.cache.wpscdn.cn/wps_assets/cfg/ad/switch/wps_load_bubble",{},function(t){return function(t){var o,i,s,n,r,a,u,c,l;sdk.noop();try{for(c=["wps.exe","wpp.exe","et.exe","wpscenter.exe","wpscloudsvr.exe"],i=t.split("\n"),l={},r=0,u=i.length;r<u;r++)o=i[r],a=o.indexOf("="),l[o.substr(0,a)]=o.substr(a+1)-0;if(null!=l.on&&(3===l.process||!(sdk.util.indexOf("qg",sdk.as.getAsProcess("name"))>-1||sdk.util.indexOf("qg",sdk.as.getAsInstall("name"))>-1)))return e(l.on,c[l.process],l.uac);if(/^11\./.test(sdk.client.info.getAppVersion()))return e(!0,c[3])}catch(n){s=n,sdk.noop()}return e&&e(!1)}}(this),function(t){return function(t){return sdk.noop(),e&&e(!1)}}(this))},Service.prototype.incrPluginLoadNumToday=function(){var e;return e=this.getPluginLoadNumToday(),sdk.tools.storage.set(this.keyPluginLoadNumToday,++e)},Service.prototype.getPluginLoadNumToday=function(){return sdk.tools.storage.get(this.keyPluginLoadNumToday)-0||0},Service.prototype.setPluginLastLoadTime=function(e){return null==e&&(e=0),sdk.tools.storage.set(this.keyPluginLastLoadTime,e-0)},Service.prototype.getPluginLastLoadTime=function(){var e;return e=sdk.tools.storage.get(this.keyPluginLastLoadTime)-0||0,new Date(e)},Service.prototype.incrPluginReloadNumToday=function(){var e;return e=this.getPluginReloadNumToday()-0||0,sdk.tools.storage.set(this.keyReloadNumToday,++e)},Service.prototype.getPluginReloadNumToday=function(){return sdk.tools.storage.get(this.keyReloadNumToday)},Service}(),window.service=new Service,window.service.start()}.call(this);
// 3318378E3A7B03EC5DEE33B620ADD8EA78D2CDF2F0589FFA6AD383EBF20695865B69E3B94F55DD098A82C66DA7D5F698661E6247C4ABB3167C8900847899EFB3